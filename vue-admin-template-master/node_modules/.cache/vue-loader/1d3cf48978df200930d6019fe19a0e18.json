{"remainingRequest":"E:\\wuhanligong-java\\music\\vue-admin-template-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\wuhanligong-java\\music\\vue-admin-template-master\\src\\views\\Editor\\Edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\wuhanligong-java\\music\\vue-admin-template-master\\src\\views\\Editor\\Edit.vue","mtime":1655009905026},{"path":"E:\\wuhanligong-java\\music\\vue-admin-template-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\wuhanligong-java\\music\\vue-admin-template-master\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\wuhanligong-java\\music\\vue-admin-template-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\wuhanligong-java\\music\\vue-admin-template-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIFRIUkVFIGZyb20gJ3RocmVlL2J1aWxkL3RocmVlLm1vZHVsZS5qcycKaW1wb3J0IFN0YXRzIGZyb20gJy4uLy4uL3N0b3JlL1N0YXRzL3N0YXRzLm1pbi5qcycKaW1wb3J0IFdpZGdldCBmcm9tICcuLi9FZGl0b3IvV2lkZ2V0L1dpZGdldC52dWUnCmltcG9ydCBBdHRyaWJ1dGUgZnJvbSAnLi4vRWRpdG9yL0F0dHJpYnV0ZS9pbmRleC52dWUnCmltcG9ydCBGb290ZXIgZnJvbSAnLi4vRWRpdG9yL0Zvb3Rlci9pbmRleC52dWUnCmltcG9ydCB7VHJhbnNmb3JtQ29udHJvbHN9IGZyb20gJ3RocmVlL2V4YW1wbGVzL2pzbS9jb250cm9scy9UcmFuc2Zvcm1Db250cm9scycKaW1wb3J0IHtEcmFnQ29udHJvbHN9IGZyb20gJ3RocmVlL2V4YW1wbGVzL2pzbS9jb250cm9scy9EcmFnQ29udHJvbHMnCmltcG9ydCB7VHJhY2tiYWxsQ29udHJvbHN9IGZyb20gJ3RocmVlL2V4YW1wbGVzL2pzbS9jb250cm9scy9UcmFja2JhbGxDb250cm9scycKaW1wb3J0IHtPcmJpdENvbnRyb2xzfSBmcm9tICd0aHJlZS9leGFtcGxlcy9qc20vY29udHJvbHMvT3JiaXRDb250cm9scycKaW1wb3J0IHsgQ29sb3IsIEdyb3VwLCBPYmplY3QzRH0gZnJvbSAnLi4vLi4vbGliL3RocmVlLm1vZHVsZS5qcycKaW1wb3J0IHtNT1VTRX0gZnJvbSAndGhyZWUvc3JjL2NvbnN0YW50cycKaW1wb3J0IHtBeGVzSGVscGVyfSBmcm9tICd0aHJlZS9zcmMvaGVscGVycy9BeGVzSGVscGVyJwppbXBvcnQge0dyaWRIZWxwZXJ9IGZyb20gJ3RocmVlL3NyYy9oZWxwZXJzL0dyaWRIZWxwZXIuanMnCmltcG9ydCB7RXZlbnRNYW5hZ2VyfSBmcm9tICcuLi8uLi9saWIvRXZlbnRNYW5hZ2VyJwppbXBvcnQge0RpcmVjdGlvbmFsTGlnaHRIZWxwZXJ9IGZyb20gJ3RocmVlL3NyYy9oZWxwZXJzL0RpcmVjdGlvbmFsTGlnaHRIZWxwZXInCmltcG9ydCB7IHJhbmdlIH0gZnJvbSAiLi4vLi4vY29tcG9uZW50cy9tb2RlL3JhbmdlIjsKaW1wb3J0IHsgbm9kZSB9IGZyb20gIi4uLy4uL2NvbXBvbmVudHMvbW9kZS9ub2RlIjsKLy/liJ3lp4vmlbDmja4KbGV0IHJlbmRlcmVyLGNhbWVyYSxzY2VuZSxnZW9tZXRyeSxtYXRlcmlhbCxtZXNoLHN0YXRzLG9ianM7Ci8vICBsZXQgY29udGFpbmVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWJnbCcpOwogICB2YXIgY29udHJvbHM9ewogICAgICAgICAgICBwb3NpdGlvblg6MCwKICAgICAgICAgICAgcG9zaXRpb25ZOjAsCiAgICAgICAgICAgIHBvc2l0aW9uWjowCiAgICAgICAgfQpsZXQgY2FtZXJhQ29udHJvbHM7CmxldCB0cmFuc2Zvcm1Db250cm9sOwpsZXQgZXZlbnRNYW5hZ2VyOwpsZXQgZGlyZWN0aW9uYWxMaWdodCxhbWJpZW50TGlnaHQ7CmxldCBpZDsKLy8gbGV0IG1vdXNlOwovLyBsZXQgcmF5Y2FzdGVyOwovKui/memHjOiusOW9leS4gOS4quWwj2J1ZwrlvZPmi5bmi73niankvZPnlaXov4flhbbku5bniankvZPkuIrml7bkvJrpgKDmiJDniankvZPlhajpu5EK5bqU6K+l5piv5p2Q6LSo6Zeu6aKY5L2/55So5LqG5rOV57q/5Y+Y5o2i6aKc6Imy5p2Q6LSo77yM5o2i5oiQ5q2j5bi46aKc6Imy5bqU6K+l5piv5rKh5pyJ6Zeu6aKYCgoqLwpsZXQgdHJhbnNpbmc9ZmFsc2U7CmxldCBheGVzSGVscGVyLGdyaWRIZWxwZXIsZGlyZWN0TGlnaHRIZWxwZXI7CmxldCBjYWNoZW9iamVjdHM7CmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6J0VkaXRvcicsCiAgICBjb21wb25lbnRzOnsKICAgICAgICBXaWRnZXQsCiAgICAgICAgQXR0cmlidXRlLAogICAgICAgIEZvb3RlcgogICAgfSwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgIHN0YXRlOnsKICAgICAgICAgICAgICAgIEdyaWRIZWxwZXI6dHJ1ZSwKICAgICAgICAgICAgICAgIEF4ZXNIZWxwZXI6dHJ1ZSwKICAgICAgICAgICAgICAgIExpZ2h0SGVscGVyOnRydWUsCiAgICAgICAgICAgICAgICBQbGFuZUhlbHBlcjpmYWxzZSwKICAgICAgICAgICAgICAgIEJveEhlbHBlcjpmYWxzZSwKICAgICAgICAgICAgICAgIENvbnRyb2w6dHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBjb25maWd1cmF0aW9uOnt9LAogICAgICAgIH0KICAgIH0sCiAgICB3YXRjaDp7CiAgICAgICAgJ3N0YXRlLkdyaWRIZWxwZXInOnsKICAgICAgICAgICAgLy8gaW1tZWRpYXRlOnRydWUsCiAgICAgICAgICAgIGRlZXA6dHJ1ZSwKICAgICAgICAgICAgaGFuZGxlcihuZXdWYWx1ZSl7CiAgICAgICAgICAgICAgICBpZihuZXdWYWx1ZSl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5BZGRHcmlkKCk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICB0aGlzLlJlbW92ZUdyaWQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgICdzdGF0ZS5BeGVzSGVscGVyJzp7CiAgICAgICAgICAgIC8vIGltbWVkaWF0ZTp0cnVlLAogICAgICAgICAgICBkZWVwOnRydWUsCiAgICAgICAgICAgIGhhbmRsZXIobmV3VmFsdWUpewogICAgICAgICAgICAgICAgaWYobmV3VmFsdWUpewogICAgICAgICAgICAgICAgICAgIHRoaXMuQWRkQXhlcygpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5SZW1vdmVBeGVzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgICdzdGF0ZS5MaWdodEhlbHBlcic6ewogICAgICAgICAgICAvLyBpbW1lZGlhdGU6dHJ1ZSwKICAgICAgICAgICAgZGVlcDp0cnVlLAogICAgICAgICAgICBoYW5kbGVyKG5ld1ZhbHVlKXsKICAgICAgICAgICAgICAgIGlmKG5ld1ZhbHVlKXsKICAgICAgICAgICAgICAgICAgICB0aGlzLkFkZExpZ2h0KCk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICB0aGlzLlJlbW92ZUxpZ2h0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgICdzdGF0ZS5Db250cm9sJzp7CiAgICAgICAgICAgIC8vIGltbWVkaWF0ZTp0cnVlLAogICAgICAgICAgICBkZWVwOnRydWUsCiAgICAgICAgICAgIGhhbmRsZXIobmV3VmFsdWUpewogICAgICAgICAgICAgICAgaWYobmV3VmFsdWUpewogICAgICAgICAgICAgICAgICAgIHRoaXMuQWRkQ29udHJvbCgpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5SZW1vdmVDb250cm9sKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIGluaXRzdGF0ZSgpewogICAgICAgICAgICB0aGlzLnN0YXRlPXsKICAgICAgICAgICAgICAgIEdyaWRIZWxwZXI6dHJ1ZSwKICAgICAgICAgICAgICAgIEF4ZXNIZWxwZXI6dHJ1ZSwKICAgICAgICAgICAgICAgIExpZ2h0SGVscGVyOnRydWUsCiAgICAgICAgICAgICAgICBQbGFuZUhlbHBlcjpmYWxzZSwKICAgICAgICAgICAgICAgIEJveEhlbHBlcjpmYWxzZSwKICAgICAgICAgICAgICAgIENvbnRyb2w6dHJ1ZQogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgQWRkTW9kZWwoKXsKICAgICAgICAgIHRoaXMuJGJ1cy4kb2ZmKCdBZGRPYmplY3RzJyk7CiAgICAgICAgICAvL+mYsuatouWkmuasoeinpuWPkWJ1c+aAu+e6vwogICAgICAgICAgICB0aGlzLiRidXMuJG9uKCdBZGRPYmplY3RzJywoZW0saXRlbSk9PnsKICAgICAgICAgICAgICAgIGlmKGl0ZW0ubmFtZT09J+WfuuehgOWHoOS9leaooeWeiyd8fGl0ZW0ubmFtZT09JzNE6Z+z5LmQ5qih5Z6LJyl7CiAgICAgICAgICAgICAgdGhpcy5BZGRFbGVtZW50KGVtLnR5cGUpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICB0aGlzLkxvYWRFbGVtZW50KGVtLnR5cGUpOwogICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgZmluZGN1cnJlbnRPYmooKXsKICAgICAgICAgICAgbGV0IHRoYXQ9dGhpczsKICAgICAgICAgICAgLy/ph43lrprlkJF0aGlzLOWlveWIqeeUqOaAu+e6vwogICAgICAgICAgICB0aGlzLiRidXMuJG9uKCdyZXF1ZXN0T2JqJywodGFyZ2V0KT0+ewogICAgICAgICAgICAgICAgbGV0IG9iamVjdD1zY2VuZS5nZXRPYmplY3RCeVByb3BlcnR5KCd1dWlkJyx0YXJnZXQudXVpZCk7CiAgICAgICAgICAgICAgICB0aGF0LiRidXMuJGVtaXQoJ3Jlc3BvbnNlT2JqJyxvYmplY3QpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgfSwKICAgICAgICBDaGVja0Zyb21UcmVlKCl7CiAgICAgICAgICAgIHRoaXMuJGJ1cy4kb24oJ2NoZWNrRXZlbnQnLCh0YXJnZXQpPT57CiAgICAgICAgICAgICAgICBpZih0aGlzLnN0YXRlLkNvbnRyb2w9PXRydWUpewogICAgICAgICAgICAgICAgaWYoIXRhcmdldCl7CiAgICAgICAgICAgICAgICAgICAgLy/lpITnkIblr7nkuo7kvKDov4fmnaXmmK/nqbrnm67moIfnmoTmg4XlhrXvvIznm7TmjqXnp7vpmaTmjqfku7YKICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtQ29udHJvbC5kZXRhY2goKTsKICAgICAgICAgICAgICAgICAgICBzY2VuZS5yZW1vdmUodHJhbnNmb3JtQ29udHJvbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZih0cmFuc2Zvcm1Db250cm9sLm9iamVjdCYmdGFyZ2V0LnV1aWQhPXRyYW5zZm9ybUNvbnRyb2wub2JqZWN0LnV1aWQpewogICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c5LuO5Zy65pmv57uT5p6E5qCR5Lit5b6X5Yiw55qE54mp5L2T5LiO55uu5YmN55qE5LiN5ZCM5omN6L+b6KGM5LqL5Lu25aSE55CGCiAgICAgICAgICAgICAgICAgICAgLy/ljbPmm7TmjaLlsITnur/mi77lj5YKCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtQ29udHJvbC5kZXRhY2goKTsKICAgICAgICAgICAgICAgICAgICBzY2VuZS5yZW1vdmUodHJhbnNmb3JtQ29udHJvbCk7CiAgICAgICAgICAgICAgICAgICAgLy/lhYjliKDpmaTlvZPliY3mjqfku7blr7nosaEKICAgICAgICAgICAgICAgICAgICBzY2VuZS50cmF2ZXJzZShmdW5jdGlvbihvYmopewogICAgICAgICAgICAgICAgICAgICAgICBpZihvYmoudXVpZD09dGFyZ2V0LnV1aWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob2JqLnR5cGUuaW5kZXhPZignSGVscGVyJyk9PS0xKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+WmguaenOS4jeaYr2hlbHBlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyog6IO95ZCm55u05o6l5LygdXVpZOi/m+adpeafpeeEtuWQjuS8oOWHuuWOu++8nwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOmcgOimgemHjeaehAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2VuZS5hZGQodHJhbnNmb3JtQ29udHJvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtQ29udHJvbC5hdHRhY2gob2JqKTsKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtQ29udHJvbC5kZXRhY2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmUucmVtb3ZlKHRyYW5zZm9ybUNvbnRyb2wpOwoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYoIXRyYW5zZm9ybUNvbnRyb2wub2JqZWN0KXsKICAgICAgICAgICAgICAgICAgICAvL+WmguaenOaOp+S7tuacrOi6q+S4jeWtmOWcqOmCo+S5iOebtOaOpeWKoAogICAgICAgICAgICAgICAgICAgIHNjZW5lLnRyYXZlcnNlKGZ1bmN0aW9uKG9iail7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9iai51dWlkPT10YXJnZXQudXVpZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+WQjOagt+mcgOimgeWIpOaWreaYr+WQpuaYr2hlbHBlcgogICAgICAgICAgICAgICAgICAgICAgICBpZihvYmoudHlwZS5pbmRleE9mKCdIZWxwZXInKT09LTEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c5LiN5pivaGVscGVyCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjZW5lLmFkZCh0cmFuc2Zvcm1Db250cm9sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db250cm9sLmF0dGFjaChvYmopOwoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db250cm9sLmRldGFjaCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2VuZS5yZW1vdmUodHJhbnNmb3JtQ29udHJvbCk7CgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIFJlbW92ZUdyaWQoKXsKICAgICAgICAgICAgc2NlbmUucmVtb3ZlKGdyaWRIZWxwZXIpOwogICAgICAgICAgICAvL2NvbnNvbGUubG9nKHNjZW5lKTsKICAgICAgICB9LAogICAgICAgIEFkZEdyaWQoKXsKICAgICAgICAgICAgc2NlbmUuYWRkKGdyaWRIZWxwZXIpOwogICAgICAgIH0sCiAgICAgICAgUmVtb3ZlQXhlcygpewogICAgICAgICAgICBzY2VuZS5yZW1vdmUoYXhlc0hlbHBlcik7CiAgICAgICAgfSwKICAgICAgICBBZGRBeGVzKCl7CiAgICAgICAgICAgIHNjZW5lLmFkZChheGVzSGVscGVyKTsKICAgICAgICB9LAogICAgICAgIFJlbW92ZUxpZ2h0KCl7CiAgICAgICAgICAgIHNjZW5lLnJlbW92ZShkaXJlY3RMaWdodEhlbHBlcik7CiAgICAgICAgfSwKICAgICAgICBBZGRMaWdodCgpewogICAgICAgICAgICBzY2VuZS5hZGQoZGlyZWN0TGlnaHRIZWxwZXIpOwogICAgICAgIH0sCiAgICAgICAgUmVtb3ZlQ29udHJvbCgpewogICAgICAgICAgICB0cmFuc2Zvcm1Db250cm9sLmRldGFjaCgpOwogICAgICAgICAgICBzY2VuZS5yZW1vdmUodHJhbnNmb3JtQ29udHJvbCk7CiAgICAgICAgICAgIGxldCBvYmplY3Q9bnVsbDsKICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdnZXRFdmVudCcsb2JqZWN0KTsKICAgICAgICB9LAogICAgICAgIEFkZENvbnRyb2woKXsKICAgICAgICAgICAgc2NlbmUuYWRkKHRyYW5zZm9ybUNvbnRyb2wpOwoKICAgICAgICB9LAogICAgICBBZGRIZWxwZXJBbmRDb250cm9sKCl7CiAgICAgICAgdGhpcy5BZGRBeGVzKCk7CiAgICAgICAgdGhpcy5BZGRDb250cm9sKCk7CiAgICAgICAgdGhpcy5BZGRHcmlkKCk7CiAgICAgICAgdGhpcy5BZGRMaWdodCgpOwogICAgICB9LAogICAgICBSZW1vdmVIZWxwZXJBbmRDb250cm9sKCl7CiAgICAgICAgdGhpcy5SZW1vdmVHcmlkKCk7CiAgICAgICAgdGhpcy5SZW1vdmVBeGVzKCk7CiAgICAgICAgdGhpcy5SZW1vdmVMaWdodCgpOwogICAgICAgIHRoaXMuUmVtb3ZlQ29udHJvbCgpOwogICAgICB9LAogICAgICAgIGluaXRIZWxwZXIoKXsKICAgICAgICAgICAgLy/liqDlnZDmoIfovbTovoXliqnlt6XlhbcKICAgICAgICAgICAgYXhlc0hlbHBlcj1uZXcgQXhlc0hlbHBlcig1MDApOwogICAgICAgICAgICBheGVzSGVscGVyLnJheWNhc3Q9KCk9Pnt9OwogICAgICAgICAgICBheGVzSGVscGVyLm5hbWU9IuWdkOagh+i9tCI7CiAgICAgICAgICAgIHNjZW5lLmFkZChheGVzSGVscGVyKTsKICAgICAgICAgICAgZ3JpZEhlbHBlcj1uZXcgR3JpZEhlbHBlcig1MDAsNDAsJ3JnYigyMDAsMjAwLDIwMCknLCdyZ2IoMTAwLDEwMCwxMDApJyk7CiAgICAgICAgICAgIGdyaWRIZWxwZXIucmF5Y2FzdD0oKT0+e307CiAgICAgICAgICAgIGdyaWRIZWxwZXIubmFtZT0i572R5qC85p2/IjsKICAgICAgICAgICAgc2NlbmUuYWRkKGdyaWRIZWxwZXIpOwogICAgICAgICAgICAvL+WwhuS4pOS4qui+heWKqeW3peWFt3JheWNhc3TlsITnur/mlrnms5Xnva7nqbrkvb/lvpflhbbnpoHnlKjlj5jmjaLmjqfku7YKICAgICAgICAgICAgZGlyZWN0TGlnaHRIZWxwZXI9bmV3IERpcmVjdGlvbmFsTGlnaHRIZWxwZXIoZGlyZWN0aW9uYWxMaWdodCw3KTsKICAgICAgICAgICAgLy9kaXJlY3RMaWdodEhlbHBlci5yYXljYXN0PSgpPT57fTsKICAgICAgICAgICAgZGlyZWN0TGlnaHRIZWxwZXIubmFtZT0i5a6a5ZCR5YWJ5Yqp5omLIjsKICAgICAgICAgICAgZGlyZWN0TGlnaHRIZWxwZXIudHlwZT0iRGlydGVjdGlvbmFsTGlnaHRIZWxwZXIiOwogICAgICAgICAgICBzY2VuZS5hZGQoZGlyZWN0TGlnaHRIZWxwZXIpOwoKCgoKICAgICAgICB9LAogICAgICAgIGluaXRDYW1lcmFDb250cm9sKCl7CiAgICAgICAgICAgIGNhbWVyYUNvbnRyb2xzPW5ldyBPcmJpdENvbnRyb2xzKGNhbWVyYSxyZW5kZXJlci5kb21FbGVtZW50KTsKICAgICAgICAgICAgY2FtZXJhQ29udHJvbHMuZW5hYmxlRGFtcGluZz10cnVlOwogICAgICAgICAgICBjYW1lcmFDb250cm9scy5tb3VzZUJ1dHRvbnM9ewogICAgICAgICAgICAgICAgTEVGVDpudWxsLAogICAgICAgICAgICAgICAgTUlERExFOk1PVVNFLkRPTExZLAogICAgICAgICAgICAgICAgUklHSFQ6TU9VU0UuUk9UQVRFCiAgICAgICAgICAgICAgICAvL+W3pumUruS4jeaOp+WItuebuOacugogICAgICAgICAgICAgICAgLy/lj7PplK7mjqfliLbml4vovawKICAgICAgICAgICAgICAgIC8v5Lit6Ze06ZSu5o6n5Yi257yp5pS+CiAgICAgICAgICAgICAgICAvL2N0cmwr5Y+z6ZSu5o6n5Yi255u45py65bmz56e7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGdldFBhcmVudHMob2JqKXsKICAgICAgICAgIGlmKG9iai5wYXJlbnQpewogICAgICAgICAgICBpZihvYmoucGFyZW50LnR5cGU9PSJTY2VuZSIpewogICAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgIHdoaWxlKG9iai5wYXJlbnQudHlwZSE9IlNjZW5lIil7CiAgICAgICAgICAgICAgICBvYmo9b2JqLnBhcmVudDsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG9iaik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBpbml0RXZlbnRNYW5hZ2VyKCl7CiAgICAgICAgICAgIGV2ZW50TWFuYWdlcj1uZXcgRXZlbnRNYW5hZ2VyKHJlbmRlcmVyLmRvbUVsZW1lbnQsc2NlbmUsY2FtZXJhLG9ianMpOwogICAgICAgICAgICBldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywoZXZlbnQpPT57CiAgICAgICAgICAgICAgICAvL+WFqOWxgGNhbnZhc+inpuWPkeaLv+WIsOeJqeS9k+aMh+mSiOmYn+WIlwogICAgICAgICAgICAgICAgaWYoZXZlbnQuaW50ZXJzZWN0aW9uLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0PWV2ZW50LmludGVyc2VjdGlvblswXS5vYmplY3Q7CgogICAgICAgICAgICAgICAgICAgIGlmKG9iamVjdD09Y2FjaGVvYmplY3RzKXsKICAgICAgICAgICAgICAgICAgICAgICAgLy/lpoLmnpzlvZPkuIvpvKDmoIfov5jlnKjlkIzkuIDkuKrniankvZPkuIvkuI3op6blj5Hku7vkvZXmk43kvZwKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihvYmplY3QhPWNhY2hlb2JqZWN0cyYmY2FjaGVvYmplY3RzKXsKICAgICAgICAgICAgICAgICAgICAgICAgLy/lpoLmnpzlvZPkuIvpvKDmoIfku47kuIDkuKrniankvZPnp7vliqjliLDlj6bkuIDkuKrniankvZPml7YKICAgICAgICAgICAgICAgICAgICAgICAgLy/lhYjop6blj5HpopzoibLmgaLlpI3lho3op6blj5Hlj5joibIKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlb2JqZWN0cy5tYXRlcmlhbC5jb2xvci5tdWx0aXBseVNjYWxhcigwLjUpOwogICAgICAgICAgICAgICAgICAgICAgICAvL+i/lOWbnuWOn+adpeminOiJsgogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy/lpoLmnpzmnInmnZDotKgKICAgICAgICAgICAgICAgICAgICBpZihvYmplY3QubWF0ZXJpYWwpewogICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubWF0ZXJpYWwuY29sb3IubXVsdGlwbHlTY2FsYXIoMik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v5Y+Y5LquCgogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZW9iamVjdHM9b2JqZWN0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c6byg5qCH56e75Yqo5Yiw5Zy65pmv56m655m95aSE5oGi5aSNCiAgICAgICAgICAgICAgICAgICAgaWYoY2FjaGVvYmplY3RzKXsKICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVvYmplY3RzLm1hdGVyaWFsLmNvbG9yLm11bHRpcGx5U2NhbGFyKDAuNSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvL+i/lOWbnuWOn+adpeminOiJsgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYWNoZW9iamVjdHM9bnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAvLyAvL+eJqeS9k+aLvuWPluS6i+S7tuWkhOeQhgogICAgICAgICAgICBldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChldmVudCk9PnsKCiAgICAgICAgICAgICAgICBpZih0cmFuc2luZyl7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNpbmc9ZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codHJhbnNpbmcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGV2ZW50LmludGVyc2VjdGlvbi5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdD1ldmVudC5pbnRlcnNlY3Rpb25bMF0ub2JqZWN0OwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50LmludGVyc2VjdGlvbik7CiAgICAgICAgICAgICAgICAgICAgaWYob2JqZWN0LnR5cGU9PSJUcmFuc2Zvcm1Db250cm9sc1BsYW5lIil7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c6YCJ5Y+W5Yiw5o6n5Yi25Zmo5pys6Lqr55u05o6l6Lez6L+HCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUNvbnRyb2wuZGV0YWNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjZW5lLnJlbW92ZSh0cmFuc2Zvcm1Db250cm9sKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgLy/pgInlj5bliLDniankvZMKICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnN0YXRlLkNvbnRyb2w9PXRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+WPquacieW9k0NvbnRyb2zlsZ7mgKflvIDlkK/ml7bmiY3lkK/nlKh0cmFuc2Zvcm1Db250cm9sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5L2G5LiN5b2x5ZON5pi+56S6VHJlZeW9k+WJjeeCueS6rgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NlbmUuYWRkKHRyYW5zZm9ybUNvbnRyb2wpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdHJhbnNmb3JtQ29udHJvbC5hdHRhY2gob2JqZWN0LnBhcmVudCBpbnN0YW5jZW9mIFRIUkVFLkdyb3VwID8gb2JqZWN0LnBhcmVudCA6IG9iamVjdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db250cm9sLmF0dGFjaCh0aGlzLmdldFBhcmVudHMob2JqZWN0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vbGV0IHV1aWQ9b2JqZWN0LnV1aWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHV1aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ2dldEV2ZW50Jyx0aGlzLmdldFBhcmVudHMob2JqZWN0KSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIC8v5b2T54K55Ye75Yiw5Zy65pmv56m655m95aSE5pe256aB55So5Y+v5o6n5Lu2CiAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db250cm9sLmRldGFjaCgpOwogICAgICAgICAgICAgICAgICAgIHNjZW5lLnJlbW92ZSh0cmFuc2Zvcm1Db250cm9sKTsKICAgICAgICAgICAgICAgICAgICBsZXQgb2JqZWN0PW51bGw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdnZXRFdmVudCcsb2JqZWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICAvL+WwhOe6v+aLvuWPluWZqAoKICAgICBpbml0TGlnaHQoKSB7CiAgICAgICAgZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmKTsgLy/mt7vliqDkuobkuIDkuKrnmb3oibLnmoTlubPooYzlhYkKICAgICAgICBkaXJlY3Rpb25hbExpZ2h0LnBvc2l0aW9uLnNldCgyMCwgNTAsIDUwKTsgLy/orr7nva7lhYnnmoTmlrnlkJEKICAgICAgICBkaXJlY3Rpb25hbExpZ2h0Lm5hbWU9IuW5s+ihjOWFiSI7CiAgICAgICAgc2NlbmUuYWRkKGRpcmVjdGlvbmFsTGlnaHQpOyAvL+a3u+WKoOWIsOWcuuaZrwogICAgICAgIG9ianMucHVzaChkaXJlY3Rpb25hbExpZ2h0KTsKICAgICAgICBhbWJpZW50TGlnaHQ9bmV3IFRIUkVFLkFtYmllbnRMaWdodCgweDIyMjIyMik7CiAgICAgICAgYW1iaWVudExpZ2h0Lm5hbWU9IuWFqOWxgOWFiSI7CiAgICAgICAgLy/mt7vliqDkuIDkuKrlhajlsYDnjq/looPlhYkKICAgICAgICBzY2VuZS5hZGQoYW1iaWVudExpZ2h0KTsKICAgICAgICAgb2Jqcy5wdXNoKGFtYmllbnRMaWdodCk7CiAgICB9LAogICAgICAgIC8vIGluaXRSYXljYXN0ZXIoKXsKICAgICAgICAvLyAgICAgLy8gcmF5Y2FzdGVyPW5ldyBUSFJFRS5SYXljYXN0ZXIoKTsKCiAgICAgICAgLy8gfSwKICAgICAgICAvL+Wvueixoee8k+WtmOWIneWni+WMlgogICAgICAgIGluaXRDYWNoZSgpewogICAgICAgICAgICBjYWNoZW9iamVjdHM9bnVsbDsKICAgICAgICB9LAogICAgICAgIGluaXRDb250cm9sKCl7CiAgLy/lj6/op4bljJblj5jmjaLmjqfku7blr7nosaEKICAgICAgICB0cmFuc2Zvcm1Db250cm9sID0gbmV3IFRyYW5zZm9ybUNvbnRyb2xzKCBjYW1lcmEscmVuZGVyZXIuZG9tRWxlbWVudCApOwogICAgICAgIHRyYW5zZm9ybUNvbnRyb2wudHlwZT0iVHJhbnNmb3JtQ29udHJvbCI7CiAgICAgICAgLy8gc2NlbmUuYWRkKCB0cmFuc2Zvcm1Db250cm9sICk7Ly/mjqfku7blr7nosaHmt7vliqDliLDlnLrmma/lr7nosaEKICAgICAgICB0cmFuc2Zvcm1Db250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlRG93bicsKGV2ZW50KT0+ewogICAgICAgICAgICAvL+WKoOS4gOS4quWPguaVsOaOp+WItumYsuatoueCueWHu+S6i+S7tuWSjOaLluaLveS6i+S7tuWGsueqgQogICAgICAgICAgICB0cmFuc2luZz10cnVlOwogICAgICAgICAgICBjb25zb2xlLmxvZyh0cmFuc2luZyk7CiAgICAgICAgfSk7CiAgICAgICAgLy/plK7nm5jmjqfliLblj6/op4bljJblj5jmjaLmjqfku7blip/og70KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsKGV2ZW50KT0+ewogICAgICAgICAgICBpZihldmVudC5rZXk9PSdlJyl7CiAgICAgICAgICAgICAgICAvL0XplK7nvKnmlL4KICAgICAgICAgICAgICAgIHRyYW5zZm9ybUNvbnRyb2wubW9kZT0ic2NhbGUiOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGV2ZW50LmtleT09J3InKXsKICAgICAgICAgICAgICAgIC8vUumUruaXi+i9rAogICAgICAgICAgICAgICAgdHJhbnNmb3JtQ29udHJvbC5tb2RlPSJyb3RhdGUiOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGV2ZW50LmtleT09J3QnKXsKICAgICAgICAgICAgICAgIC8vVOmUruW5s+enuwogICAgICAgICAgICAgICAgdHJhbnNmb3JtQ29udHJvbC5tb2RlPSJ0cmFuc2xhdGUiOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgTG9hZEVsZW1lbnQodHlwZSl7CgogICAgICAgICAgc2NlbmUuYmFja2dyb3VuZCA9IG5ldyBUSFJFRS5DdWJlVGV4dHVyZUxvYWRlcigpLmxvYWQoWwogICAgICAgICAgcmVxdWlyZSgnQC9hc3NldHMvc2t5Ym94LycrdHlwZSsnL0xlZnQucG5nJyksCiAgICAgICAgICByZXF1aXJlKCdAL2Fzc2V0cy9za3lib3gvJyt0eXBlKycvUmlnaHQucG5nJyksCiAgICAgICAgICByZXF1aXJlKCdAL2Fzc2V0cy9za3lib3gvJyt0eXBlKycvVXAucG5nJyksCiAgICAgICAgICByZXF1aXJlKCdAL2Fzc2V0cy9za3lib3gvJyt0eXBlKycvRG93bi5wbmcnKSwKICAgICAgICAgIHJlcXVpcmUoJ0AvYXNzZXRzL3NreWJveC8nK3R5cGUrJy9Gcm9udC5wbmcnKSwKICAgICAgICAgIHJlcXVpcmUoJ0AvYXNzZXRzL3NreWJveC8nK3R5cGUrJy9CYWNrLnBuZycpCiAgICAgICAgXSk7CgogICAgICAgIH0sCiAgICAgICAgQWRkRWxlbWVudCh0eXBlKXsKICAgICAgICAgICAgaWYodHlwZT09J2xvbmVseVBsYW5ldCcpewogICAgICAgICAgICAgICAgdGhpcy5pbml0Qm94KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZih0eXBlPT0nYmV6aWVyQ3VydmUnKXsKICAgICAgICAgICAgICAgIHRoaXMuaW5pdENvbmUoKTsKICAgICAgICAgICAgfWVsc2UgaWYodHlwZT09J2V0aGVyZWFUb25lJyl7CiAgICAgICAgICAgICAgICB0aGlzLmluaXRDeWxpbmRlcigpOwogICAgICAgICAgICB9ZWxzZSBpZih0eXBlPT0nZWxlY3Ryb25pY011c2ljJyl7CiAgICAgICAgICAgICAgICB0aGlzLmluaXRTcGhlcmUoKTsKICAgICAgICAgICAgfWVsc2UgaWYodHlwZT09J2JsYXN0U3Vid29vZmVyJyl7CiAgICAgICAgICAgICAgICB0aGlzLmluaXRUb3J1cygpOwogICAgICAgICAgICB9ZWxzZSBpZih0eXBlPT0nQmFyTW9kZWwnKXsKICAgICAgICAgICAgICAgIHRoaXMuaW5pdEJhcnMoKTsKICAgICAgICAgICAgICAgIHRoaXMuc2NlbmVDaGFuZ2VkRXZlbnQoKTsKICAgICAgICAgICAgfWVsc2UgaWYodHlwZT09J0xpbmVNb2RlbCcpewogICAgICAgICAgICAgICAgdGhpcy5pbml0TGluZSgpOwogICAgICAgICAgICAgICAgdGhpcy5zY2VuZUNoYW5nZWRFdmVudCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpbml0Qm94KCl7CiAgICAgICAgICAgIHZhciBtYXRlcmlhbD1uZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoKTsKICAgICAgICAgICAgbWF0ZXJpYWwuY29sb3I9bmV3IENvbG9yKDAuOCwwLjIsMC4yKTsKICAgICAgICAgICAgdmFyIGJveD1uZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuQm94R2VvbWV0cnkoNSw1LDUpLG1hdGVyaWFsKTsKICAgICAgICAgICAgYm94LnBvc2l0aW9uLnNldCgtNTAsIDIwLCAwKTsKICAgICAgICAgICAgYm94Lm5hbWU9IuebkuWtkCI7CiAgICAgICAgICAgIHNjZW5lLmFkZChib3gpOwogICAgICAgICAgICBvYmpzLnB1c2goYm94KTsKICAgICAgICAgICAgdGhpcy5zY2VuZUNoYW5nZWRFdmVudCgpOwogICAgICAgIH0sCiAgICAgICBpbml0Q29uZSgpewogICAgICAgIHZhciBtYXRlcmlhbD1uZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoKTsKICAgICAgICBtYXRlcmlhbC5jb2xvcj1uZXcgQ29sb3IoMC43LDAuNiwwLjYpOwogICAgICAgICB2YXIgY29uZT1uZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuQ29uZUdlb21ldHJ5KDUsMjAsMzIpLG1hdGVyaWFsKTsKICAgICAgICAgIGNvbmUucG9zaXRpb24uc2V0KDIwLCAyMCwgMCk7CiAgICAgICAgICBjb25lLm5hbWU9IuWchumUpSI7CiAgICAgICAgICAgc2NlbmUuYWRkKGNvbmUpOwogICAgICAgICAgIG9ianMucHVzaChjb25lKTsKICAgICAgICAgIHRoaXMuc2NlbmVDaGFuZ2VkRXZlbnQoKTsKICAgICAgICAgICAvL3JlbmRlcmVyLnJlbmRlcihzY2VuZSxjYW1lcmEpOy8v5riy5p+TCgoKICAgICAgIH0sCiAgICAgICBpbml0Q3lsaW5kZXIoKXsKICAgICAgICAgICAgdmFyIG1hdGVyaWFsPW5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCgpOwogICAgICAgICAgICBtYXRlcmlhbC5jb2xvcj1uZXcgQ29sb3IoMC44LDAuNywwLjIpOwogICAgICAgICAgIHZhciBjeWxpbmRlcj1uZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuQ3lsaW5kZXJHZW9tZXRyeSg1LCA1LCAyMCwgMzIpLG1hdGVyaWFsKTsKICAgICAgICAgICBjeWxpbmRlci5wb3NpdGlvbi5zZXQoNTAsMjAsMCk7CiAgICAgICAgICAgY3lsaW5kZXIubmFtZT0i5ZyG5p+xIjsKICAgICAgICAgICBzY2VuZS5hZGQoY3lsaW5kZXIpOwogICAgICAgICAgIG9ianMucHVzaChjeWxpbmRlcik7CiAgICAgICAgICAgdGhpcy5zY2VuZUNoYW5nZWRFdmVudCgpOwogICAgICAgICAgIC8vcmVuZGVyZXIucmVuZGVyKHNjZW5lLGNhbWVyYSk7Ly/muLLmn5MKCiAgICAgICB9LAogICAgICAgaW5pdFNwaGVyZSgpewogICAgICAgICAgIHZhciBtYXRlcmlhbD1uZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoKTsKICAgICAgICAgICAgbWF0ZXJpYWwuY29sb3I9bmV3IENvbG9yKDAuMiwwLjcsMC4yKTsKICAgICAgICAgIHZhciAgc3BoZXJlPW5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5TcGhlcmVHZW9tZXRyeSg1LCAzMiwgMzIpLG1hdGVyaWFsKTsKICAgICAgICAgICBzcGhlcmUucG9zaXRpb24uc2V0KC0yMCwgLTIwLCAwKTsKICAgICAgICAgICBzcGhlcmUubmFtZT0i55CDIjsKICAgICAgICAgICAgc2NlbmUuYWRkKHNwaGVyZSk7CiAgICAgICAgICAgIG9ianMucHVzaChzcGhlcmUpOwogICAgICAgICAgICB0aGlzLnNjZW5lQ2hhbmdlZEV2ZW50KCk7CgoKCiAgICAgICB9LAogICAgICAgaW5pdFRvcnVzKCl7CiAgICAgICAgICAgdmFyIG1hdGVyaWFsPW5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCgpOwogICAgICAgICAgICBtYXRlcmlhbC5jb2xvcj1uZXcgQ29sb3IoMC4zLDAuMSwwLjkpOwogICAgICAgICAgIHZhciB0b3J1cyA9bmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLlRvcnVzR2VvbWV0cnkoMTAsIDMsIDE2LCAxMDApLG1hdGVyaWFsKTsKICAgICAgICAgICAgdG9ydXMucG9zaXRpb24uc2V0KDUwLCAtMjAsIDApOwogICAgICAgICAgICB0b3J1cy5uYW1lPSLlnIbnjq8iOwogICAgICAgICAgICBzY2VuZS5hZGQodG9ydXMpOwogICAgICAgICAgICBvYmpzLnB1c2godG9ydXMpOwogICAgICAgICAgICB0aGlzLnNjZW5lQ2hhbmdlZEV2ZW50KCk7CiAgICAgICAgICAgIC8vcmVuZGVyZXIucmVuZGVyKHNjZW5lLGNhbWVyYSk7Ly/muLLmn5MKCgogICAgICAgfSwKICAgICAgICBpbml0KCl7CiAgICAgICAgICAgIHRoaXMuaW5pdFJlbmRlcmVyKCk7CiAgICAgICAgICAgIHRoaXMuaW5pdFNjZW5lKCk7CiAgICAgICAgICAgIHRoaXMuaW5pdENhbWVyYSgpOwogICAgICAgICAgICB0aGlzLmluaXRMaWdodCgpOwogICAgICAgICAgICB0aGlzLmluaXRNZXNoKCk7CiAgICAgICAgICAgIC8vIHRoaXMuaW5pdFJheWNhc3RlcigpOwogICAgICAgICAgICB0aGlzLmluaXRDYWNoZSgpOwogICAgICAgICAgICB0aGlzLmluaXRDYW1lcmFDb250cm9sKCk7CiAgICAgICAgICAgIHRoaXMuaW5pdENvbnRyb2woKTsKICAgICAgICAgICAgdGhpcy5pbml0SGVscGVyKCk7CiAgICAgICAgICAgIHRoaXMud2F0Y2hIZWxwZXIoKTsKICAgICAgICAgICAgLy8gdGhpcy5pbml0TW91c2VFdmVudCgpOwogICAgICAgICAgICB0aGlzLmluaXRFdmVudE1hbmFnZXIoKTsKICAgICAgICAgICAgdGhpcy5zZW5kaWQoKTsKICAgICAgICAgICAgdGhpcy5pbml0U3RhdHMoKTsKCiAgICAgICAgICAgIC8vIGluaXREYXRHVUkoKTsKICAgICAgICAgICAgdGhpcy5zY2VuZUNoYW5nZWRFdmVudCgpOwogICAgICAgICAgICB0aGlzLmFuaW1hdGUoKTsKICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhzY2VuZSk7CgogICAgICAgIH0sCiAgICAgICAgd2F0Y2hIZWxwZXIoKXsKICAgICAgICAgICAgbGV0IHN0YXRlPXRoaXMuc3RhdGU7CiAgICAgICAgICAgICB0aGlzLiRidXMuJGVtaXQoJ3N0YXRlQ29udHJvbCcsc3RhdGUpOwogICAgICAgIH0sCiAgICAgICAgc2NlbmVDaGFuZ2VkRXZlbnQoKXsKICAgICAgICAgICAgLy9yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5zY2VuZUNoYW5nZWRFdmVudCgpKTsKICAgICAgICAgICAgbGV0IHNjZW5lbGlzdD1zY2VuZS5jaGlsZHJlbjsKICAgICAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzY2VuZUNoYW5nZWQnLHNjZW5lbGlzdCk7CiAgICAgICAgfSwKICAgICAgICAvL+m8oOagh+S6i+WKoeWkhOeQhu+8iOWMheaLrOeCueWHu+S6i+S7tuOAgeenu+WKqOS6i+S7tu+8iQogICAgICAgIC8vIGluaXRNb3VzZUV2ZW50KCl7CiAgICAgICAgICAgIC8v57uZY2FudmFz5a+56LGh6L+b6KGM6byg5qCH5Z2Q5qCH6L2s5o2iCiAgICAgICAgICAgIC8vIG1vdXNlPW5ldyBWZWN0b3IyKCk7CiAgICAgICAgICAgIC8vIGxldCBkb21YPTA7CiAgICAgICAgICAgIC8vIGxldCBkb21ZPTA7CiAgICAgICAgICAgIC8vIGxldCB3aWR0aD0wOwogICAgICAgICAgICAvLyBsZXQgaGVpZ2h0PTA7CiAgICAgICAgICAgIC8vIHJlbmRlcmVyLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywoZXZlbnQpPT57CiAgICAgICAgICAgIC8vICAgICAvL2NvbnNvbGUubG9nKGV2ZW50Lm9mZnNldFgsZXZlbnQub2Zmc2V0WSk7CiAgICAgICAgICAgIC8vICAgICBkb21YPWV2ZW50Lm9mZnNldFg7CiAgICAgICAgICAgIC8vICAgICBkb21ZPWV2ZW50Lm9mZnNldFk7CiAgICAgICAgICAgIC8vICAgICB3aWR0aD1yZW5kZXJlci5kb21FbGVtZW50Lm9mZnNldFdpZHRoOwogICAgICAgICAgICAvLyAgICAgaGVpZ2h0PXJlbmRlcmVyLmRvbUVsZW1lbnQub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAvLyAgICAgbW91c2UueD1kb21YL3dpZHRoKjItMTsKICAgICAgICAgICAgLy8gICAgIG1vdXNlLnk9LWRvbVkqMi9oZWlnaHQrMTsKICAgICAgICAgICAgLy8gICAgIC8vIGNvbnNvbGUubG9nKG1vdXNlLngsbW91c2UueSk7CiAgICAgICAgICAgIC8vICAgICByYXljYXN0ZXIuc2V0RnJvbUNhbWVyYShtb3VzZSxjYW1lcmEpOwogICAgICAgICAgICAvLyAgICAgLy/pmLLmraLmjqfliLblmajooqvpgInkuK0KICAgICAgICAgICAgLy8gICAgIHNjZW5lLnJlbW92ZSh0cmFuc2Zvcm1Db250cm9sKTsKICAgICAgICAgICAgLy8gICAgIGNvbnN0IGludGVyc2VjdGlvbj1yYXljYXN0ZXIuaW50ZXJzZWN0T2JqZWN0cyhzY2VuZS5jaGlsZHJlbixmYWxzZSk7CiAgICAgICAgICAgIC8vICAgICAvL+aKiuaJgOacieaciWNoaWxkcmVu55qE5bGP6JS95o6J77yM5Y+v5Lul6Ziy5q2i5a+5aGVscGVy6L+b6KGM5o6n5Yi2CiAgICAgICAgICAgIC8vICAgICBzY2VuZS5hZGQodHJhbnNmb3JtQ29udHJvbCk7CiAgICAgICAgICAgIC8vICAgICBpZihpbnRlcnNlY3Rpb24ubGVuZ3RoKXsKICAgICAgICAgICAgLy8gICAgICAgICAvL+WmguaenOaLvuWPluWIsOadkOi0qOeJqeS9kwogICAgICAgICAgICAvLyAgICAgICAgIGNvbnN0IG9iamVjdD1pbnRlcnNlY3Rpb25bMF0ub2JqZWN0OwogICAgICAgICAgICAvLyAgICAgICAgIC8v5aaC5p6c5b2T5LiL54mp5L2T5LiN5piv5LiK5qyh57yT5a2Y54mp5L2T77yM6K+05piO5piv5LuO5LiN5ZCM54mp5L2T5LiK56e75Yiw5b2T5YmN54mp5L2T5LiK6Kem5Y+RbW91c2VlbnRlcuS6i+S7tgogICAgICAgICAgICAvLyAgICAgICAgIGlmKG9iamVjdCE9Y2FjaGVvYmplY3RzKXsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgaWYoY2FjaGVvYmplY3RzKXsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIC8v5b2T6byg5qCH5LuO5LiA5Liq54mp5L2T56e75Yqo5Yiw5Y+m5LiA5Liq54mp5L2T5pe277yM5YWI6Kem5Y+R5LmL5YmN57yT5a2Y54mp5L2T55qEbW91c2VsZWF2ZeaWueazlQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgLy/lho3op6blj5HlvZPliY3niankvZPnmoRtb3VzZWVudGVy5pa55rOVCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBjYWNoZW9iamVjdHMuZGlzcGF0Y2hFdmVudCh7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHR5cGU6J21vdXNlbGVhdmUnCiAgICAgICAgICAgIC8vICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gICAgICAgICAgICAgICBvYmplY3QuZGlzcGF0Y2hFdmVudCh7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHR5cGU6J21vdXNlZW50ZXInCiAgICAgICAgICAgIC8vICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vICAgICAgICAgfS8v5aaC5p6c55u4562J6Kem5Y+RbW91c2Vtb3Zl5pa55rOV5b6X5Yiw54mp5L2T5Z2Q5qCHKOm8oOagh+S4gOebtOWcqOeJqeS9k+S4iuenu+WKqCkKICAgICAgICAgICAgLy8gICAgICAgICBlbHNlIGlmKG9iamVjdD09Y2FjaGVvYmplY3RzKXsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgb2JqZWN0LmRpc3BhdGNoRXZlbnQoewogICAgICAgICAgICAvLyAgICAgICAgICAgICB0eXBlOidtb3VzZW1vdmUnCiAgICAgICAgICAgIC8vICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vICAgICAgICAgfQogICAgICAgICAgICAvLyAgICAgICAgIGNhY2hlb2JqZWN0cz1vYmplY3Q7CiAgICAgICAgICAgIC8vICAgICB9ZWxzZXsKICAgICAgICAgICAgLy8gICAgICAgICAvL+W9k+m8oOagh+S7juS4gOS4queJqeS9k+enu+WKqOWIsOWwhOe6v+aLvuWPluWZqOaLvuWPluS4jeWIsOeJqeS9k+aXtuS5n+S8muinpuWPkeS5i+WJjeeahOeJqeS9k+eahG1vdXNlbGVhdmXmlrnms5UKICAgICAgICAgICAgLy8gICAgICAgICAgaWYoY2FjaGVvYmplY3RzKXsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIC8v5b2T6byg5qCH5LuO5LiA5Liq54mp5L2T56e75Yqo5Yiw5Y+m5LiA5Liq54mp5L2T5pe277yM5YWI6Kem5Y+R5LmL5YmN57yT5a2Y54mp5L2T55qEbW91c2VsZWF2ZeaWueazlQogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgLy/lho3op6blj5HlvZPliY3niankvZPnmoRtb3VzZWVudGVy5pa55rOVCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBjYWNoZW9iamVjdHMuZGlzcGF0Y2hFdmVudCh7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHR5cGU6J21vdXNlbGVhdmUnCiAgICAgICAgICAgIC8vICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgIC8vICAgICAgICAgY2FjaGVvYmplY3RzPW51bGw7CgoKICAgICAgICAgICAgLy8gICAgIH0KCgogICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgLy8gLy8gLy/niankvZPmi77lj5bkuovku7blpITnkIYKICAgICAgICAgICAgLy8gcmVuZGVyZXIuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGV2ZW50KT0+ewogICAgICAgICAgICAvLyAgICAgaWYodHJhbnNpbmcpewogICAgICAgICAgICAvLyAgICAgICAgIHRyYW5zaW5nPWZhbHNlOwogICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gICAgIC8vIHJheWNhc3Rlci5zZXRGcm9tQ2FtZXJhKG1vdXNlLGNhbWVyYSk7CiAgICAgICAgICAgIC8vICAgICAvLyAvL+mYsuatouaOp+WItuWZqOiiq+mAieS4rQogICAgICAgICAgICAvLyAgICAgLy8gc2NlbmUucmVtb3ZlKHRyYW5zZm9ybUNvbnRyb2wpOwogICAgICAgICAgICAvLyAgICAgLy8gY29uc3QgaW50ZXJzZWN0aW9uPXJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3RzKHNjZW5lLmNoaWxkcmVuLGZhbHNlKTsKICAgICAgICAgICAgLy8gICAgIC8vIC8v5oqK5omA5pyJ5pyJY2hpbGRyZW7nmoTlsY/olL3mjonvvIzlj6/ku6XpmLLmraLlr7loZWxwZXLov5vooYzmjqfliLYKICAgICAgICAgICAgLy8gICAgIC8vIHNjZW5lLmFkZCh0cmFuc2Zvcm1Db250cm9sKTsKICAgICAgICAgICAgLy8gICAgIC8vIGlmKGludGVyc2VjdGlvbi5sZW5ndGgpewoKCiAgICAgICAgICAgIC8vICAgICAvLyAgICAgY29uc3Qgb2JqZWN0PWludGVyc2VjdGlvblswXS5vYmplY3Q7CiAgICAgICAgICAgIC8vICAgICAvLyAgICAgdHJhbnNmb3JtQ29udHJvbC5hdHRhY2gob2JqZWN0KTsKICAgICAgICAgICAgLy8gICAgIC8vIH1lbHNlewogICAgICAgICAgICAvLyAgICAgLy8gICAgIC8v5b2T54K55Ye75Yiw5Zy65pmv56m655m95aSE5pe256aB55So5Y+v5o6n5Lu2CiAgICAgICAgICAgIC8vICAgICAvLyAgICB0cmFuc2Zvcm1Db250cm9sLmRldGFjaCgpOwogICAgICAgICAgICAvLyAgICAgLy8gfQogICAgICAgICAgICAvLyB9KTsKCiAgICAgICAgLy8gfSwKICAgICAgICBpbml0U3RhdHMoKXsKICAgICAgICAgICAgc3RhdHMgPSBuZXcgU3RhdHMoKTsKICAgICAgICAgICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOyAvL+e7neWvueWdkOaghwogICAgICAgICAgICAgICAgc3RhdHMuZG9tRWxlbWVudC5zdHlsZS5sZWZ0ID0gJzBweCc7Ly8gKDAsMClweCzlt6bkuIrop5IKICAgICAgICAgICAgICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUudG9wID0gJzBweCc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWJnbCcpLmFwcGVuZENoaWxkKHN0YXRzLmRvbUVsZW1lbnQpOwoKICAgICAgICB9LAogICAgICAgIHVwZGF0ZVBvc2l0aW9uKCl7CiAgICAgICAgICAgIG1lc2gucG9zaXRpb24uc2V0KGNvbnRyb2xzLnBvc2l0aW9uWCxjb250cm9scy5wb3NpdGlvblksY29udHJvbHMucG9zaXRpb25aKTsKICAgICAgICB9LAogICAgICAgIC8v5Yid5aeL5YyW5riy5p+T5ZmoCiAgICAgICAgaW5pdFJlbmRlcmVyKCl7CgoKICAgICAgICAgICAgcmVuZGVyZXI9bmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoe2FudGlhbGlhczp0cnVlfSk7Ly/lrp7kvovljJbmuLLmn5PlmagKICAgICAgICAgICAgLy/mipfplK/pvb/lvIDlkK8KICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCowLjcsd2luZG93LmlubmVySGVpZ2h0KjAuNyk7Ly/orr7nva7lrr3pq5gKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dlYmdsJykuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7Ly/mt7vliqDliLBkb20KICAgICAgICB9LAogICAgICAgIC8v5Yid5aeL5YyW5Zy65pmvCiAgICAgICAgaW5pdFNjZW5lKCl7CgogICAgICAgICAgICBzY2VuZT1uZXcgVEhSRUUuU2NlbmUoKTsvL+WunuS+i+WMluWcuuaZrwogICAgICAgICAgICBvYmpzPVtdOwogICAgICAgICAgICAgc2NlbmUuYmFja2dyb3VuZCA9IG5ldyBUSFJFRS5DdWJlVGV4dHVyZUxvYWRlcigpLmxvYWQoWwogICAgICAgICAgcmVxdWlyZSgnQC9hc3NldHMvc2t5Ym94L0dhbGF4eS9MZWZ0LnBuZycpLAogICAgICAgICAgcmVxdWlyZSgnQC9hc3NldHMvc2t5Ym94L0dhbGF4eS9SaWdodC5wbmcnKSwKICAgICAgICAgIHJlcXVpcmUoJ0AvYXNzZXRzL3NreWJveC9HYWxheHkvVXAucG5nJyksCiAgICAgICAgICByZXF1aXJlKCdAL2Fzc2V0cy9za3lib3gvR2FsYXh5L0Rvd24ucG5nJyksCiAgICAgICAgICByZXF1aXJlKCdAL2Fzc2V0cy9za3lib3gvR2FsYXh5L0Zyb250LnBuZycpLAogICAgICAgICAgcmVxdWlyZSgnQC9hc3NldHMvc2t5Ym94L0dhbGF4eS9CYWNrLnBuZycpCiAgICAgICAgXSk7CiAgICAgICAgLy8gICBzY2VuZS5iYWNrZ3JvdW5kPW5ldyBUSFJFRS5Db2xvciggMHhERUU2RTYgKTsKICAgICAgICAgICAgLy8gdGhpcy4kYnVzLiRlbWl0KCdzY2VuZUNoYW5nZWQnLHNjZW5lKTsKICAgICAgICB9LAogICAgICAgIC8v5Yid5aeL5YyW55u45py6CiAgICAgICAgaW5pdENhbWVyYSgpewogICAgICAgICAgICBjYW1lcmE9bmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKDQ1LHdpbmRvdy5pbm5lcldpZHRoL3dpbmRvdy5pbm5lckhlaWdodCwwLjEsMjAwKQogICAgICAgICAgICAvL+WunuS+i+WMluebuOacuuOAkQogICAgICAgICAgICBjYW1lcmEucG9zaXRpb24uc2V0KDAsMCwxNTApOwogICAgICAgIH0sCiAgICAgICAgLy/liJvlu7rmqKHlnosKICAgICAgICBpbml0TWVzaCgpewogICAgICAgICAgICAvLyBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSg1LCA1LCA1ICk7IC8v5Yib5bu65Yeg5L2V5L2TCiAgICAgICAgICAgIC8vIHZhciBtYXRlcmlhbD1uZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoKTsKICAgICAgICAgICAgLy8gbWF0ZXJpYWwuY29sb3I9bmV3IENvbG9yKDAuNywwLjIsMC4yKTsgLy/liJvlu7rmnZDotKgKCiAgICAgICAgICAgIC8vIG1lc2ggPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7IC8v5Yib5bu6572R5qC8CiAgICAgICAgICAgIC8vIG1lc2gubmFtZT0i55uS5a2QIjsKCiAgICAgICAgICAgIC8vIHNjZW5lLmFkZCggbWVzaCApOyAvL+Wwhue9keagvOa3u+WKoOWIsOWcuuaZrwoKCiAgICAgICAgICAgIC8vIHRoaXMuaW5pdENvbmUoKTsKICAgICAgICAgICAgLy8gdGhpcy5pbml0Qm94KCk7CiAgICAgICAgICAgIHRoaXMuaW5pdExpbmUoKTsKICAgICAgICAgICAgdGhpcy5pbml0QmFycygpOwoKICAgICAgICB9LAoKICAgICAgICBpbml0QmFycygpewogICAgICAgICAgICB0aGlzLmF1ZGlvQmFycygyNSwxMjgpOwogICAgICAgIH0sCgogICAgICAgIGF1ZGlvQmFycyhyYWRpdXMsIGNvdW50RGF0YSkgewogICAgICBsZXQgYmFyR3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAgbGV0IFIgPSByYWRpdXM7CiAgICAgIGxldCBOID0gY291bnREYXRhOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGxldCBtaW5Hcm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICAgIGxldCBib3ggPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoMSwgMSwgMSk7CiAgICAgICAgbGV0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKHsKICAgICAgICAgIGNvbG9yOiAweDAwZmZmZgogICAgICAgIH0pOyAvLyDmnZDotKjlr7nosaEKICAgICAgICBsZXQgbSA9IGk7CiAgICAgICAgbGV0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChib3gsIG1hdGVyaWFsKTsKCiAgICAgICAgbWVzaC5wb3NpdGlvbi55ID0gMC41OwogICAgICAgIG1pbkdyb3VwLmFkZChtZXNoKTsKICAgICAgICBtaW5Hcm91cC5wb3NpdGlvbi5zZXQoCiAgICAgICAgICBNYXRoLnNpbigoKG0gKiBNYXRoLlBJKSAvIE4pICogMikgKiBSLAogICAgICAgICAgTWF0aC5jb3MoKChtICogTWF0aC5QSSkgLyBOKSAqIDIpICogUiwKICAgICAgICAgIDAKICAgICAgICApOwogICAgICAgbWluR3JvdXAucm90YXRpb24ueiA9ICgoLW0gKiBNYXRoLlBJKSAvIE4pICogMjsKICAgICAgICBiYXJHcm91cC5hZGQobWluR3JvdXApOwogICAgICB9CiAgICAgIGJhckdyb3VwLm5hbWU9Iumfs+mikeiwsSI7CiAgICAgIGJhckdyb3VwLnR5cGU9IkJhckdyb3VwIjsKICAgICAgc2NlbmUuYWRkKGJhckdyb3VwKTsKICAgICAgb2Jqcy5wdXNoKGJhckdyb3VwKTsKICAgIH0sCi8qIOi/memHjOacieS4quWOn+eQhu+8jOS4uuS7gOS5iOWvuemfs+mikee6v+WSjOmfs+mikee7hOi/m+ihjOenu+WKqOaXi+i9rOaTjeS9nOWQjiDkvp3nhLblj6/ku6XmoLnmja7liJ3lp4vljJbnmoTpn7PpopHmlbDmja7ov5vooYzph43nlLsK5oyJ5Y6f55CG5p2l6K+05bqU6K+l6KaB6YeN5paw6K6h566X5ZCE5Liq57q/5q6155qE5Z2Q5qCH5YC86L+b6KGM6YeN57uY77yM5Li65LuA5LmI6L+Z6YeM5a+85Ye65pWw5o2u5ZCO5L6d54S25Y+v5Lul5Yip55So5Yid5aeL5YyW55qECmJhck5vZGVz6L+b6KGM5LiA5Liq57q/5q616K6h566X6YeN5Zue5ZCn77yM5Y6f5Zug5piv5Zug5Li677yM5Zyo57yW6L6R5Zmo5Lit5a+55LiA5Liq57uE5a+56LGh6L+b6KGM5pON5L2c5pe277yM5YW25ZCE5a2Q5a+56LGhCueahOWdkOagh+W5tuS4jeS8muWPmOWMlu+8jOWPquaUueWPmOi/meS4que7hOWvueixoeeahOS9jee9ruOAgeaXi+i9rOetieS/oeaBr++8jOWFtuWtkOWvueixoeeahOWdkOagh+S4gOebtOaYr+ebuOWvueS6juWFtueItuWvueixoeeahArlnZDmoIfljbPmnKzlnLDlnZDmoIfvvIzogIzpnZ7kuJbnlYzlnZDmoIfvvIzlj6rmnInlvZPniLblr7nosaHmmK9zY2VuZeWcuuaZr+aXtu+8jOacrOWcsOWdkOagh+aJjeetieS6juS4lueVjOWdkOaghwogKi8KICAgICAgICBpbml0TGluZSgpewogICAgICAgICAgICB0aGlzLmF1ZGlvTGluZXMoMjAsMjU2KTsKICAgICAgICB9LAogICAgICAgIHJlbmRlckdlb21ldHJpZXModmVydGljZXMpIHsKICAgICAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgICAgIHZlcnRpY2VzID0gdmVydGljZXMuY29uY2F0KHZlcnRpY2VzWzBdKTsKICAgICAgICAgICAgLy/lkIjlubbmlbDnu4TvvIzmiorph4zlpJbkvY3nva7lkYrnn6XopoHnlLvnmoTnur8KICAgICAgICAgICAgdmVydGljZXMuZm9yRWFjaCh2YWx1ZSA9PiB7CiAgICAgICAgICAgIHJlcy5wdXNoKHZhbHVlLngsIHZhbHVlLnksIDApOwogICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUobmV3IEZsb2F0MzJBcnJheShyZXMpLCAzKTsKICAgIH0sCiAgICAgICAgYXVkaW9MaW5lcyhyYWRpdXMsIGNvdW50RGF0YSkgewogICAgICAgICAgICB2YXIgYmFyTm9kZXMgPSByYW5nZSgwLCBjb3VudERhdGEpLm1hcChpbmRleCA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IG5vZGUoCiAgICAgICAgICAgICAgICByYWRpdXMsCiAgICAgICAgICAgICAgICAoKGluZGV4IC8gY291bnREYXRhKSAqIDM2MCArIDQ1KSAlIDM2MCwKICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc29sZS5sb2coYmFyTm9kZXMpOwogICAgICAgICAgICAvL+W+l+WIsOS4gOS4quiusOW9leWchuS4ijI1NuS4queCueeahOS9jee9ruS/oeaBr+eahOaVsOe7hAogICAgICAgICAgICBjb25zdCBsaW5lTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTGluZUJhc2ljTWF0ZXJpYWwoewogICAgICAgICAgICAgICAgY29sb3I6IDB4MDBmZmZmCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgYmFyTGluZSA9IHJhbmdlKDAsIGNvdW50RGF0YSkubWFwKGluZGV4ID0+IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5MaW5lKAogICAgICAgICAgICAgICAgbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCkuc2V0QXR0cmlidXRlKAogICAgICAgICAgICAgICAgICAgICJwb3NpdGlvbiIsCiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckdlb21ldHJpZXMoWwogICAgICAgICAgICAgICAgICAgIGJhck5vZGVzW2luZGV4XS5wb3NpdGlvbkEoKSwKICAgICAgICAgICAgICAgICAgICAgYmFyTm9kZXNbaW5kZXhdLnBvc2l0aW9uQigpCiAgICAgICAgICAgIF0pCiAgICAgICAgICApLAogICAgICAgICAgICBsaW5lTWF0ZXJpYWwKICAgICAgICAgICAgKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgb3V0TGluZSA9IG5ldyBUSFJFRS5MaW5lKAogICAgICAgIG5ldyBUSFJFRS5CdWZmZXJHZW9tZXRyeSgpLnNldEF0dHJpYnV0ZSgKICAgICAgICAgICJwb3NpdGlvbiIsCiAgICAgICAgICB0aGlzLnJlbmRlckdlb21ldHJpZXMoYmFyTm9kZXMubWFwKG5vZGUgPT4gbm9kZS5wb3NpdGlvbkEoKSkpCiAgICAgICAgKSwKICAgICAgICBsaW5lTWF0ZXJpYWwKICAgICAgKTsKCiAgICAgIHZhciBpbkxpbmUgPSBuZXcgVEhSRUUuTGluZSgKICAgICAgICBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKS5zZXRBdHRyaWJ1dGUoCiAgICAgICAgICAicG9zaXRpb24iLAogICAgICAgICAgdGhpcy5yZW5kZXJHZW9tZXRyaWVzKGJhck5vZGVzLm1hcChub2RlID0+IG5vZGUucG9zaXRpb25CKCkpKQogICAgICAgICksCiAgICAgICAgbGluZU1hdGVyaWFsCiAgICAgICk7CgogICAgICB2YXIgbGluZXNHcm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgICBsaW5lc0dyb3VwLmFkZChvdXRMaW5lKTsKICAgICAgbGluZXNHcm91cC5hZGQoaW5MaW5lKTsKICAgICAgYmFyTGluZS5mb3JFYWNoKGxpbmUgPT4gbGluZXNHcm91cC5hZGQobGluZSkpOwogICAgICBsaW5lc0dyb3VwLm5hbWU9Iumfs+mikee6vyI7CiAgICAgIGxpbmVzR3JvdXAudHlwZT0iTGluZUdyb3VwIjsKICAgICAgc2NlbmUuYWRkKGxpbmVzR3JvdXApOwogICAgICBvYmpzLnB1c2gobGluZXNHcm91cCk7CiAgICB9LAoKCgogICAgICAgIHVwZGF0ZSgpewogICAgICAgICAgICBzdGF0cy51cGRhdGUoKTsKICAgICAgICB9LAogICAgICAgIFJlc2V0KCl7CgogICAgICAgIH0sCiAgICAgICAgUmVzZXRBbGwoKXsKICAgICAgICAgICAgdGhpcy4kYnVzLiRvbigncmVzZXQnLCgpPT57CiAgICAgICAgICAgICAgICB0aGlzLlJlc2V0KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgRXhwb3J0KCl7CiAgICAgICAgICAgIGxldCB0aGF0PXRoaXM7CiAgICAgICAgICAgIHRoaXMuJGJ1cy4kb24oJ2V4cG9ydCcsKCk9PnsKICAgICAgICAgICAgLy8gaWYoc2NlbmUuY2hpbGRyZW4ubGVuZ3RoPjApewogICAgICAgICAgICAvLyAgICAgbGV0IG9iajsKICAgICAgICAgICAgLy8gICAgIC8v5Yig6Zmk5omA5pyJaGVscGVy77yM5Y+q5L+d55WZ5YWJ5rqQ44CB5p2Q6LSoCiAgICAgICAgICAgIC8vICAgICBmb3IodmFyIGk9c2NlbmUuY2hpbGRyZW4ubGVuZ3RoLTE7aT49MDtpLS0pewogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgICAgICBvYmo9c2NlbmUuY2hpbGRyZW5baV07CiAgICAgICAgICAgIC8vICAgICAgICAgaWYob2JqLnR5cGUuaW5kZXhPZignSGVscGVyJykhPS0xfHxvYmoudHlwZS5pbmRleE9mKCdDb250cm9sJykhPS0xKXsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgIHNjZW5lLnJlbW92ZShvYmopOwogICAgICAgICAgICAvLyAgICAgICAgIH0KICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgIHRoYXQuUmVtb3ZlSGVscGVyQW5kQ29udHJvbCgpOwoKICAgICAgICAgICAgICAgIC8v5Zug5Li65q+P5qyh6L+t5Luj5LitLmNoaWxkcmVuIOS4gOaXpnJlbW92ZeWQjuS7juWktOW8gOWni+aJp+ihjAogICAgICAgICAgICAgICAgLy/mlbDnu4TkvJrmlLnlj5jvvIzlm6DmraTkvb/nlKjpgY3ljobnmoRmb3JFYWNo5Lmf5aW977yMdHJhdmVyc2XkuZ/lpb3mlbDnu4TnmoQKICAgICAgICAgICAgICAgIC8v57Si5byV5YWo6YO95pS55Y+Y77yM5Y+q5Lya5Yig6Zmk5LiA5Liq5a+56LGhCiAgICAgICAgICAgICAgICAvL+S9huWmguaenOS7juWQjuW8gOWni+mBjeWOhuWIoOmZpO+8jOavj+asoXJlbW92ZeWQjuWJjemdoueahOe0ouW8leS5n+WNs+aYr+acqumBjeWOhui/h+eahOiKgueCuee0ouW8leS4jeS8muWPmAogICAgICAgICAgICAgICAgLy/kvb/nlKhzdGF0ZeWAvOeEtuWQjui/m+ihjOa3seW6puebkeWQrOS+neeEtuS4jeihjO+8jOWboOS4undhdGNo5pa55rOV5q+P5qyh5ZyobW91bnRlZOS5i+WQjgogICAgICAgICAgICAgICAgLy/ov5nlsLHlr7zoh7TkuoblpoLmnpxtb3VudGVk5Lit55qEZGF0YeWAvOWPmOWMlu+8jOaIkemcgOimgeWvvOWHuueahOaVsOaNrui/mOaYr+WOn+adpeaVsOaNru+8jHdhdGNo5Y+q5Lya5Zyo5LmL5ZCOCiAgICAgICAgICAgICAgICAvL+WPkeeUn+S9nOeUqOOAggoKICAgICAgICAgICAgdmFyIEpTT05TdHI9SlNPTi5zdHJpbmdpZnkoc2NlbmUudG9KU09OKCkpOwoKICAgICAgICAgICAgdGhpcy5kb3dubG9hZCgic2NlbmUuanNvbiIsSlNPTlN0cik7CiAgICAgICAgICAgIHRoYXQuQWRkSGVscGVyQW5kQ29udHJvbCgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGRvd25sb2FkKGZpbGVuYW1lLHRleHQpewogICAgICAgICAgICB2YXIgcG9tPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgcG9tLnNldEF0dHJpYnV0ZSgnaHJlZicsJ2RhdGE6dGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04LCcKICAgICAgICAgICAgK2VuY29kZVVSSUNvbXBvbmVudCh0ZXh0KSk7CiAgICAgICAgICAgIHBvbS5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJyxmaWxlbmFtZSk7CiAgICAgICAgICAgIGlmKGRvY3VtZW50LmNyZWF0ZUV2ZW50KXsKICAgICAgICAgICAgICAgIHZhciBldmVudD1kb2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMnKTsKICAgICAgICAgICAgICAgIGV2ZW50LmluaXRNb3VzZUV2ZW50KCdjbGljaycsdHJ1ZSwgZmFsc2UsCiAgICAgICAgICAgICAgICB3aW5kb3csMCwwLDAsMCwwLGZhbHNlLGZhbHNlLGZhbHNlLGZhbHNlLDAsbnVsbCk7CiAgICAgICAgICAgICAgICBwb20uZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgcG9tLmNsaWNrKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICAvL+i/kOihjOWKqOeUuwogICAgICAgIGFuaW1hdGUoKXsKICAgICAgICAgICAgaWQ9cmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuYW5pbWF0ZSk7Ly/lvqrnjq/osIPnlKjlh73mlbAKCiAgICAgICAgICAgIC8vIG1lc2gucm90YXRpb24ueCs9MC4wMTsKICAgICAgICAgICAgLy8gLy8gLy/mr4/luKfnvZHmoLzmqKHlnovmsr946L205peL6L2sMC4wMeW8p+W6pgogICAgICAgICAgICAvLyBtZXNoLnJvdGF0aW9uLnkrPTAuMDI7CiAgICAgICAgICAgIC8vIC8v5q+P5bin572R5qC85qih5Z6L5rK/eei9tOaXi+i9rDAuMDLlvKfluqYKICAgICAgICAgICAgLy8gLy9zdGF0cy51cGRhdGUoKTsvL+abtOaWsOaAp+iDveajgOa1i+ahhgoKICAgICAgICAgICAgdGhpcy51cGRhdGUoKTsKICAgICAgICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLGNhbWVyYSk7Ly/muLLmn5MKICAgICAgICB9LAogICAgICBzZW5kcmVzKCl7CiAgICAgICAgICB0aGlzLiRidXMuJG9uKCdzZW5kcmVzJywocmVzKT0+ewogICAgICAgICAgIHZhciBsb2FkZXI9bmV3IFRIUkVFLk9iamVjdExvYWRlcigpOwogICAgICAgICAgIGxvYWRlci5wYXJzZShyZXMsZnVuY3Rpb24gKG9iail7CiAgICAgICAgICAgICBzY2VuZT1vYmo7CgogICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICB9LAogICAgICByZXF1ZXN0c2F2ZSgpewogICAgICAgICAgbGV0IHRoYXQ9dGhpczsKICAgICAgICB0aGlzLiRidXMuJG9uKCdyZXF1ZXN0c2F2ZScsKCk9PnsKICAgICAgICAgIC8vIGlmKHNjZW5lLmNoaWxkcmVuLmxlbmd0aD4wKXsKICAgICAgICAgIC8vICAgbGV0IG9iajsKICAgICAgICAgIC8vICAgLy/liKDpmaTmiYDmnIloZWxwZXLvvIzlj6rkv53nlZnlhYnmupDjgIHmnZDotKgKICAgICAgICAgIC8vICAgZm9yKHZhciBpPXNjZW5lLmNoaWxkcmVuLmxlbmd0aC0xO2k+PTA7aS0tKXsKICAgICAgICAgIC8vCiAgICAgICAgICAvLyAgICAgb2JqPXNjZW5lLmNoaWxkcmVuW2ldOwogICAgICAgICAgLy8gICAgIGlmKG9iai50eXBlLmluZGV4T2YoJ0hlbHBlcicpIT0tMXx8b2JqLnR5cGUuaW5kZXhPZignQ29udHJvbCcpIT0tMSl7CiAgICAgICAgICAvLyAgICAgICBzY2VuZS5yZW1vdmUob2JqKTsKICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAvLyAgIH0KICAgICAgICAgIC8vIH0KICAgICAgICAgIHRoYXQuUmVtb3ZlSGVscGVyQW5kQ29udHJvbCgpOwogICAgICAgICAgdmFyIEpTT05TdHI9SlNPTi5zdHJpbmdpZnkoc2NlbmUudG9KU09OKCkpOwogICAgICAgICAgbGV0IGZpbGU9bmV3IEZpbGUoW0pTT05TdHJdLCdzY2VuZS5qc29uJyx7CiAgICAgICAgICAgIHR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBEYXRlLm5vdygpCiAgICAgICAgICB9KTsKICAgICAgICAgIC8v57uE5ZCI5oiQ5paH5Lu2CiAgICAgICAgICBsZXQgcGFyYW09bmV3IEZvcm1EYXRhKCk7CiAgICAgICAgICBwYXJhbS5hcHBlbmQoJ2ZpbGUnLGZpbGUpOwogICAgICAgICAgbGV0IGNvbmZpZz17aGVhZGVyczp7J0NvbnRlbnQtVHlwZSc6J211bHRpcGFydC9mb3JtLWRhdGEnfX0KICAgICAgICAgIHRoaXMucmVxdWVzdC5wb3N0KCJodHRwOi8vbG9jYWxob3N0OjkwOTAvdXBsb2FkIiwKICAgICAgICAgICAgcGFyYW0sY29uZmlnKS50aGVuKHJlcz0+ewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXMpOwogICAgICAgICAgICB0aGF0LiRidXMuJGVtaXQoJ3Jlc3BvbnNlc2F2ZScscmVzLmZpbGVpZCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcy5maWxlaWQpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhzY2VuZSk7CiAgICAgICAgICAgIHRoYXQuQWRkSGVscGVyQW5kQ29udHJvbCgpOwogICAgICAgICAgfSk7CiAgICAgICAgICAvL+aPkOS6pOihqOWNleaWh+S7tui/lOWbnmlkCgoKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgc2VuZGlkKCl7CiAgICAgICAgbGV0IGlkPW51bGw7CiAgICAgICAgdGhpcy4kYnVzLiRlbWl0KCdzZW5kZmlsZWlkJyxpZCk7CiAgICAgIH0sCiAgICAgIHN0YXJ0ZWRpdCgpewoKICAgICAgICAgIGxldCB0aGF0PXRoaXM7CiAgICAgICAgdGhpcy4kYnVzLiRvbignZWlkdGZpbGUnLChyZXMsaWQpPT57CiAgICAgICAgICAvL29ianM9W107CiAgICAgICAgICAvL+WboOS4uuavj+asoei3s+i9rOi3r+eUsemDveS8mumHjeaWsOWIneWni+WMluWFtuS7luW3peWFt++8jOi/memHjOWFiOWIoOmZpAogICAgICAgICAgLy/miopqc29u5pWw5o2u5omT5YyF5oiQ5paH5Lu26YCa6L+HdXJs6L+b6KGM5Lyg6L6TCiAgICAgICAgICB2YXIgSlNPTlN0cj1KU09OLnN0cmluZ2lmeShyZXMpOwogICAgICAgICAgbGV0IGZpbGU9bmV3IEZpbGUoW0pTT05TdHJdLCdzY2VuZS5qc29uJyx7CiAgICAgICAgICAgIHR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBEYXRlLm5vdygpCiAgICAgICAgICB9KTsKICAgICAgICAgIC8v57uE5ZCI5oiQ5paH5Lu2CiAgICAgICAgICBsZXQgdXJsID0gbnVsbCA7CiAgICAgICAgICBpZiAod2luZG93LmNyZWF0ZU9iamVjdFVSTCE9dW5kZWZpbmVkKSB7IC8vIGJhc2ljCiAgICAgICAgICAgIHVybCA9IHdpbmRvdy5jcmVhdGVPYmplY3RVUkwoZmlsZSkgOwogICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuVVJMIT11bmRlZmluZWQpIHsgLy8gbW96aWxsYShmaXJlZm94KQogICAgICAgICAgICB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKSA7CiAgICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy53ZWJraXRVUkwhPXVuZGVmaW5lZCkgeyAvLyB3ZWJraXQgb3IgY2hyb21lCiAgICAgICAgICAgIHVybCA9IHdpbmRvdy53ZWJraXRVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpIDsKICAgICAgICAgIH0KCgogICAgICAgICAgLy90aGF0LlJlbW92ZUhlbHBlckFuZENvbnRyb2woKTsKICAgICAgICAgIHZhciBsb2FkZXI9bmV3IFRIUkVFLk9iamVjdExvYWRlcigpOwogICAgICAgICAgbG9hZGVyLmxvYWQodXJsLAogICAgICAgICAgICBmdW5jdGlvbihvYmopewogICAgICAgICAgICAgLy9sZXQgbmV3b2Jqcz1bXTsKICAgICAgICAgICAgdGhhdC5SZW1vdmVIZWxwZXJBbmRDb250cm9sKCk7CiAgICAgICAgICAgIHNjZW5lPW9iajsKICAgICAgICAgICAgdGhhdC5BZGRIZWxwZXJBbmRDb250cm9sKCk7CiAgICAgICAgICAgICAgLy8gaWYob2JqLmNoaWxkcmVuLmxlbmd0aD4wKXsKICAgICAgICAgICAgICAvLyAgIGxldCBjaGlsZG9iajsKICAgICAgICAgICAgICAvLyAgIGZvcih2YXIgaT1vYmouY2hpbGRyZW4ubGVuZ3RoLTE7aT49MDtpLS0pewogICAgICAgICAgICAgIC8vICAgICBjaGlsZG9iaj1vYmouY2hpbGRyZW5baV07CiAgICAgICAgICAgICAgLy8gICAgIGlmKGNoaWxkb2JqLnR5cGUuaW5kZXhPZignT2JqZWN0M0QnKSE9LTF8fGNoaWxkb2JqLnR5cGUuaW5kZXhPZignTWVzaCcpIT0tMSl7CiAgICAgICAgICAgICAgLy8gICAgICAgbmV3b2Jqcy5wdXNoKGNoaWxkb2JqKTsKICAgICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAgIC8vICAgICBpZigoY2hpbGRvYmoudHlwZS5pbmRleE9mKCdMaWdodCcpIT0tMSYmY2hpbGRvYmoudHlwZS5pbmRleE9mKCdIZWxwZXInKT09LTEpKXsKICAgICAgICAgICAgICAvLyAgICAgICBuZXdvYmpzLnB1c2goY2hpbGRvYmopOwogICAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgIC8vIG9ianM9bmV3b2JqczsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhvYmpzKTsKCgogICAgICAgICAgICAgIC8vIGlmKHNjZW5lLmNoaWxkcmVuLmxlbmd0aD4wKXsKICAgICAgICAgICAgICAvLyAgIGxldCBjaGlsZG9iajsKICAgICAgICAgICAgICAvLyAgIC8v5Yig6Zmk5omA5pyJ5Y+v5pON5L2c5a+56LGhCiAgICAgICAgICAgICAgLy8gICBmb3IodmFyIGk9c2NlbmUuY2hpbGRyZW4ubGVuZ3RoLTE7aT49MDtpLS0pewogICAgICAgICAgICAgIC8vICAgICBjaGlsZG9iaj1zY2VuZS5jaGlsZHJlbltpXTsKICAgICAgICAgICAgICAvLyAgICAgaWYoKGNoaWxkb2JqLnR5cGUuaW5kZXhPZignTGlnaHQnKSE9LTEmJmNoaWxkb2JqLnR5cGUuaW5kZXhPZignSGVscGVyJyk9PS0xKXx8Y2hpbGRvYmoudHlwZS5pbmRleE9mKCdHcm91cCcpIT0tMXx8Y2hpbGRvYmoudHlwZS5pbmRleE9mKCdNZXNoJykhPS0xKXsKICAgICAgICAgICAgICAvLyAgICAgICBzY2VuZS5yZW1vdmUoY2hpbGRvYmopOwogICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgIC8vICAgfSBjb25zb2xlLmxvZyhzY2VuZSk7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKG9ianMpOwogICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAvL+WKoOi9veWujOaIkOWQjui/m+ihjAogICAgICAgICAgICAgIC8vIHNjZW5lLmJhY2tncm91bmQ9b2JqLmJhY2tncm91bmQ7CiAgICAgICAgICAgICAgLy8gaWYob2JqLmNoaWxkcmVuLmxlbmd0aD4wKSB7CiAgICAgICAgICAgICAgLy8gICBsZXQgY2hpbGRvYmo7CiAgICAgICAgICAgICAgLy8gICBmb3IgKHZhciBpID0gb2JqLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgLy8gICAgIGNoaWxkb2JqID0gb2JqLmNoaWxkcmVuW2ldOwogICAgICAgICAgICAgIC8vICAgICBvYmoucmVtb3ZlKGNoaWxkb2JqKTsKICAgICAgICAgICAgICAvLyAgICAgY2hpbGRvYmoucGFyZW50PXNjZW5lOwogICAgICAgICAgICAgIC8vICAgICBzY2VuZS5hZGQoY2hpbGRvYmopOwogICAgICAgICAgICAgIC8vICAgICBvYmpzLnB1c2goY2hpbGRvYmopOwogICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICBldmVudE1hbmFnZXIuUmVtb3ZlRXZlbnQoKTsKICAgICAgICAgICAgIHRoYXQuaW5pdEV2ZW50TWFuYWdlcigpOwogICAgICAgICAgICAgIHRoYXQuc2NlbmVDaGFuZ2VkRXZlbnQoKTsKICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKG9ianMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBvblByb2dyZXNzIGNhbGxiYWNrCiAgICAgICAgICAgIGZ1bmN0aW9uICggeGhyICkgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAoeGhyLmxvYWRlZCAvIHhoci50b3RhbCAqIDEwMCkgKyAnJSBsb2FkZWQnICk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAvLyBvbkVycm9yIGNhbGxiYWNrCiAgICAgICAgICAgIGZ1bmN0aW9uICggZXJyICkgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoICdBbiBlcnJvciBoYXBwZW5lZCcrZXJyICk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgLy8gbG9hZGVyLnBhcnNlKHJlcyxmdW5jdGlvbiAob2JqKXsKICAgICAgICAgIC8vCiAgICAgICAgICAvLyAgfQogICAgICAgICAgLy8gIGNvbnNvbGUubG9nKHNjZW5lKTsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhzY2VuZSk7CiAgICAgICAgICAgLy8gIHRoYXQuQWRkSGVscGVyQW5kQ29udHJvbCgpOwogICAgICAgICAgIC8vICAvL+mcgOimgeWIneWni+WMluS4gOS4i29ianMKICAgICAgICAgICAvLyAgaWYoc2NlbmUuY2hpbGRyZW4ubGVuZ3RoPjApewogICAgICAgICAgIC8vICAgIGxldCBvYmo7CiAgICAgICAgICAgLy8gICAgLy/liKDpmaTmiYDmnIloZWxwZXLvvIzlj6rkv53nlZnlhYnmupDjgIHmnZDotKgKICAgICAgICAgICAvLyAgICBvYmpzPVtdOwogICAgICAgICAgIC8vICAgIC8v5Yid5aeL5YyW5LiA5LiLCiAgICAgICAgICAgLy8gICAgZm9yKHZhciBpPXNjZW5lLmNoaWxkcmVuLmxlbmd0aC0xO2k+PTA7aS0tKXsKICAgICAgICAgICAvLwogICAgICAgICAgIC8vICAgICAgb2JqPXNjZW5lLmNoaWxkcmVuW2ldOwogICAgICAgICAgIC8vICAgICAgaWYob2JqLnR5cGUuaW5kZXhPZignTWVzaCcpIT0tMSl7CiAgICAgICAgICAgLy8gICAgICAgIC8v6K+05piO5piv6ZyA6KaB5pON5L2c55qE54mp5L2TCiAgICAgICAgICAgLy8gICAgICAgIG9ianMucHVzaChvYmopOwogICAgICAgICAgIC8vICAgICAgfQogICAgICAgICAgIC8vICAgICAgaWYob2JqLnR5cGUuaW5kZXhPZignT2JqZWN0M0QnKSE9LTEpewogICAgICAgICAgIC8vICAgICAgICBvYmpzLnB1c2gob2JqKTsKICAgICAgICAgICAvLyAgICAgIH0KICAgICAgICAgICAvLyAgICAgIC8vIGlmKG9iai50eXBlLmluZGV4T2YoJ0xpZ2h0JykhPS0xJiZvYmoudHlwZS5pbmRleE9mKCdIZWxwZXInKT09LTEpewogICAgICAgICAgIC8vICAgICAgLy8gICBvYmpzLnB1c2gob2JqKTsKICAgICAgICAgICAvLyAgICAgIC8vIH0KICAgICAgICAgICAvLyAgICB9CiAgICAgICAgICAgLy8gICAgY29uc29sZS5sb2cob2Jqcyk7CiAgICAgICAgICAgLy8gIH0KICAgICAgICAgICAvLyAgdHJhbnNpbmc9ZmFsc2U7CiAgICAgICAgICAgLy8KICAgICAgICAgICAvLyAvLyB0aGF0LmluaXRFdmVudE1hbmFnZXIoKTsKICAgICAgICAgIC8vICAgIHRoYXQuc2NlbmVDaGFuZ2VkRXZlbnQoKTsKICAgICAgICAgIC8vCiAgICAgICAgICAvLyB9KTsKICAgICAgICAgIHRoYXQuJGJ1cy4kZW1pdCgnc2VuZGZpbGVpZCcsaWQpOwoKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgYWRkbmV3KCl7CiAgICAgICAgICBsZXQgdGhhdD10aGlzOwogICAgICAgICAgdGhpcy4kYnVzLiRvZmYoJ2FkZGZpbGUnKTsKICAgICAgICB0aGlzLiRidXMuJG9uKCdhZGRmaWxlJywoKT0+ewogICAgICAgICAgbGV0IGlkPW51bGw7CiAgICAgICAgICB0aGF0LiRidXMuJGVtaXQoJ3NlbmRmaWxlaWQnLGlkKTsKICAgICAgICAgIC8v6K6+572u5Liq5pe26Ze06Ziy5q2iIOWKoOi9vemXrumimAoKICAgICAgICAgIHRoYXQuUmVtb3ZlSGVscGVyQW5kQ29udHJvbCgpOwogICAgICAgICAgdGhhdC5pbml0U2NlbmUoKTsKICAgICAgICAgIHRoYXQuaW5pdExpZ2h0KCk7CiAgICAgICAgICB0aGF0LmluaXRNZXNoKCk7CiAgICAgICAgICB0aGF0LkFkZEhlbHBlckFuZENvbnRyb2woKTsKICAgICAgICAgIGV2ZW50TWFuYWdlci5SZW1vdmVFdmVudCgpOwogICAgICAgICAgdGhhdC5pbml0RXZlbnRNYW5hZ2VyKCk7CiAgICAgICAgICB0aGF0LnNjZW5lQ2hhbmdlZEV2ZW50KCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogIG1vdW50ZWQoKSB7CiAgICAgICAgdGhpcy5pbml0KCk7CiAgICAgICAgdGhpcy5DaGVja0Zyb21UcmVlKCk7CiAgICAgICAgdGhpcy5maW5kY3VycmVudE9iaigpOwogICAgICAgIHRoaXMuQWRkTW9kZWwoKTsKICAgICAgICB0aGlzLlJlc2V0QWxsKCk7CiAgICAgICAgdGhpcy5FeHBvcnQoKTsKICAgICAgICB0aGlzLnNlbmRyZXMoKTsKICAgICAgICB0aGlzLnJlcXVlc3RzYXZlKCk7CiAgICAgICAgdGhpcy5zdGFydGVkaXQoKTsKICAgICAgICB0aGlzLmFkZG5ldygpOwogICAgfSwKfQo="},{"version":3,"sources":["Edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Edit.vue","sourceRoot":"src/views/Editor","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <div>\n        <el-container>\n           <!-- <el-header>Header</el-header> -->\n           <el-container>\n                <el-aside width=\"260px\">\n                       <Widget/>\n                </el-aside>\n\n                <el-main >\n                    <el-scrollbar class=\"Scrollbar\">\n                        <div id=\"webgl\" style=\"position:relative\">\n                        </div>\n                    </el-scrollbar>\n                </el-main>\n                <el-aside width=\"260px\">\n                    <Attribute/>\n                </el-aside>\n            </el-container>\n            <el-footer>\n                <Footer/>\n            </el-footer>\n        </el-container>\n      <!-- <el-row :gutter=\"20\">\n        <el-col :span=\"3\" :xs=\"24\">\n          <el-card style=\"margin-bottom:20px;height: 500px;\">\n\n          </el-card>\n        </el-col>\n        <el-col :span=\"16\" :xs=\"24\">\n            <div id=\"webgl\" style=\"position:relative\">\n\n            </div>\n        </el-col>\n        <el-col :span=\"3\" :xs=\"24\">\n          <el-card style=\"margin-bottom:20px;height: 500px;\">\n\n          </el-card>\n        </el-col>\n      </el-row> -->\n    </div>\n\n\n  </div>\n</template>\n\n<script>\nimport * as THREE from 'three/build/three.module.js'\nimport Stats from '../../store/Stats/stats.min.js'\nimport Widget from '../Editor/Widget/Widget.vue'\nimport Attribute from '../Editor/Attribute/index.vue'\nimport Footer from '../Editor/Footer/index.vue'\nimport {TransformControls} from 'three/examples/jsm/controls/TransformControls'\nimport {DragControls} from 'three/examples/jsm/controls/DragControls'\nimport {TrackballControls} from 'three/examples/jsm/controls/TrackballControls'\nimport {OrbitControls} from 'three/examples/jsm/controls/OrbitControls'\nimport { Color, Group, Object3D} from '../../lib/three.module.js'\nimport {MOUSE} from 'three/src/constants'\nimport {AxesHelper} from 'three/src/helpers/AxesHelper'\nimport {GridHelper} from 'three/src/helpers/GridHelper.js'\nimport {EventManager} from '../../lib/EventManager'\nimport {DirectionalLightHelper} from 'three/src/helpers/DirectionalLightHelper'\nimport { range } from \"../../components/mode/range\";\nimport { node } from \"../../components/mode/node\";\n//初始数据\nlet renderer,camera,scene,geometry,material,mesh,stats,objs;\n//  let container=document.getElementById('webgl');\n   var controls={\n            positionX:0,\n            positionY:0,\n            positionZ:0\n        }\nlet cameraControls;\nlet transformControl;\nlet eventManager;\nlet directionalLight,ambientLight;\nlet id;\n// let mouse;\n// let raycaster;\n/*这里记录一个小bug\n当拖拽物体略过其他物体上时会造成物体全黑\n应该是材质问题使用了法线变换颜色材质，换成正常颜色应该是没有问题\n\n*/\nlet transing=false;\nlet axesHelper,gridHelper,directLightHelper;\nlet cacheobjects;\nexport default {\n    name:'Editor',\n    components:{\n        Widget,\n        Attribute,\n        Footer\n    },\n    data() {\n        return {\n             state:{\n                GridHelper:true,\n                AxesHelper:true,\n                LightHelper:true,\n                PlaneHelper:false,\n                BoxHelper:false,\n                Control:true\n            },\n            configuration:{},\n        }\n    },\n    watch:{\n        'state.GridHelper':{\n            // immediate:true,\n            deep:true,\n            handler(newValue){\n                if(newValue){\n                    this.AddGrid();\n                }else{\n                    this.RemoveGrid();\n                }\n            }\n        },\n         'state.AxesHelper':{\n            // immediate:true,\n            deep:true,\n            handler(newValue){\n                if(newValue){\n                    this.AddAxes();\n                }else{\n                    this.RemoveAxes();\n                }\n            }\n        },\n        'state.LightHelper':{\n            // immediate:true,\n            deep:true,\n            handler(newValue){\n                if(newValue){\n                    this.AddLight();\n                }else{\n                    this.RemoveLight();\n                }\n            }\n        },\n        'state.Control':{\n            // immediate:true,\n            deep:true,\n            handler(newValue){\n                if(newValue){\n                    this.AddControl();\n                }else{\n                    this.RemoveControl();\n                }\n            }\n        }\n    },\n    methods: {\n        initstate(){\n            this.state={\n                GridHelper:true,\n                AxesHelper:true,\n                LightHelper:true,\n                PlaneHelper:false,\n                BoxHelper:false,\n                Control:true\n            };\n        },\n        AddModel(){\n          this.$bus.$off('AddObjects');\n          //防止多次触发bus总线\n            this.$bus.$on('AddObjects',(em,item)=>{\n                if(item.name=='基础几何模型'||item.name=='3D音乐模型'){\n              this.AddElement(em.type);\n          }\n          else{\n              this.LoadElement(em.type);\n          }\n            })\n        },\n        findcurrentObj(){\n            let that=this;\n            //重定向this,好利用总线\n            this.$bus.$on('requestObj',(target)=>{\n                let object=scene.getObjectByProperty('uuid',target.uuid);\n                that.$bus.$emit('responseObj',object);\n            });\n\n        },\n        CheckFromTree(){\n            this.$bus.$on('checkEvent',(target)=>{\n                if(this.state.Control==true){\n                if(!target){\n                    //处理对于传过来是空目标的情况，直接移除控件\n                     transformControl.detach();\n                    scene.remove(transformControl);\n                }\n                else {\n                    if(transformControl.object&&target.uuid!=transformControl.object.uuid){\n                    //如果从场景结构树中得到的物体与目前的不同才进行事件处理\n                    //即更换射线拾取\n\n                    transformControl.detach();\n                    scene.remove(transformControl);\n                    //先删除当前控件对象\n                    scene.traverse(function(obj){\n                        if(obj.uuid==target.uuid){\n                            if(obj.type.indexOf('Helper')==-1){\n                                //如果不是helper\n                               /* 能否直接传uuid进来查然后传出去？\n\n                               需要重构\n                               */\n                                scene.add(transformControl);\n                                transformControl.attach(obj);\n\n\n                            }\n                              else{\n                                  transformControl.detach();\n                                 scene.remove(transformControl);\n\n\n                              }\n                             return;\n                    }\n                    });\n\n                }\n                else if(!transformControl.object){\n                    //如果控件本身不存在那么直接加\n                    scene.traverse(function(obj){\n                        if(obj.uuid==target.uuid){\n                            //同样需要判断是否是helper\n                        if(obj.type.indexOf('Helper')==-1){\n                                //如果不是helper\n\n                                scene.add(transformControl);\n                                transformControl.attach(obj);\n\n\n                            }\n                              else{\n                                  transformControl.detach();\n                                 scene.remove(transformControl);\n\n\n                              }\n                        return;\n                    }\n                    });\n                }\n                }\n                }\n            });\n        },\n        RemoveGrid(){\n            scene.remove(gridHelper);\n            //console.log(scene);\n        },\n        AddGrid(){\n            scene.add(gridHelper);\n        },\n        RemoveAxes(){\n            scene.remove(axesHelper);\n        },\n        AddAxes(){\n            scene.add(axesHelper);\n        },\n        RemoveLight(){\n            scene.remove(directLightHelper);\n        },\n        AddLight(){\n            scene.add(directLightHelper);\n        },\n        RemoveControl(){\n            transformControl.detach();\n            scene.remove(transformControl);\n            let object=null;\n            this.$bus.$emit('getEvent',object);\n        },\n        AddControl(){\n            scene.add(transformControl);\n\n        },\n      AddHelperAndControl(){\n        this.AddAxes();\n        this.AddControl();\n        this.AddGrid();\n        this.AddLight();\n      },\n      RemoveHelperAndControl(){\n        this.RemoveGrid();\n        this.RemoveAxes();\n        this.RemoveLight();\n        this.RemoveControl();\n      },\n        initHelper(){\n            //加坐标轴辅助工具\n            axesHelper=new AxesHelper(500);\n            axesHelper.raycast=()=>{};\n            axesHelper.name=\"坐标轴\";\n            scene.add(axesHelper);\n            gridHelper=new GridHelper(500,40,'rgb(200,200,200)','rgb(100,100,100)');\n            gridHelper.raycast=()=>{};\n            gridHelper.name=\"网格板\";\n            scene.add(gridHelper);\n            //将两个辅助工具raycast射线方法置空使得其禁用变换控件\n            directLightHelper=new DirectionalLightHelper(directionalLight,7);\n            //directLightHelper.raycast=()=>{};\n            directLightHelper.name=\"定向光助手\";\n            directLightHelper.type=\"DirtectionalLightHelper\";\n            scene.add(directLightHelper);\n\n\n\n\n        },\n        initCameraControl(){\n            cameraControls=new OrbitControls(camera,renderer.domElement);\n            cameraControls.enableDamping=true;\n            cameraControls.mouseButtons={\n                LEFT:null,\n                MIDDLE:MOUSE.DOLLY,\n                RIGHT:MOUSE.ROTATE\n                //左键不控制相机\n                //右键控制旋转\n                //中间键控制缩放\n                //ctrl+右键控制相机平移\n            }\n        },\n        getParents(obj){\n          if(obj.parent){\n            if(obj.parent.type==\"Scene\"){\n              return obj;\n            }else{\n              while(obj.parent.type!=\"Scene\"){\n                obj=obj.parent;\n                console.log(obj);\n              }\n              return obj;\n            }\n          }\n        },\n\n        initEventManager(){\n            eventManager=new EventManager(renderer.domElement,scene,camera,objs);\n            eventManager.addEventListener('mousemove',(event)=>{\n                //全局canvas触发拿到物体指针队列\n                if(event.intersection.length){\n                    const object=event.intersection[0].object;\n\n                    if(object==cacheobjects){\n                        //如果当下鼠标还在同一个物体下不触发任何操作\n\n                        return;\n                    }\n                    else if(object!=cacheobjects&&cacheobjects){\n                        //如果当下鼠标从一个物体移动到另一个物体时\n                        //先触发颜色恢复再触发变色\n\n                        cacheobjects.material.color.multiplyScalar(0.5);\n                        //返回原来颜色\n                    }\n\n                    //如果有材质\n                    if(object.material){\n                        object.material.color.multiplyScalar(2);\n                        //变亮\n\n                        cacheobjects=object;\n                    }\n                }else{\n                    //如果鼠标移动到场景空白处恢复\n                    if(cacheobjects){\n                        cacheobjects.material.color.multiplyScalar(0.5);\n\n                        //返回原来颜色\n                    }\n                    cacheobjects=null;\n                }\n            });\n             // //物体拾取事件处理\n            eventManager.addEventListener('click',(event)=>{\n\n                if(transing){\n                    transing=false;\n                    console.log(transing);\n                    return false;\n                }\n                if(event.intersection.length){\n                    const object=event.intersection[0].object;\n                    console.log(event.intersection);\n                    if(object.type==\"TransformControlsPlane\"){\n                        //如果选取到控制器本身直接跳过\n                        transformControl.detach();\n                        scene.remove(transformControl);\n                    }\n                    else{\n                        //选取到物体\n                          if(this.state.Control==true)\n                          {\n                              //只有当Control属性开启时才启用transformControl\n                              //但不影响显示Tree当前点亮\n                            scene.add(transformControl);\n\n                            //transformControl.attach(object.parent instanceof THREE.Group ? object.parent : object);\n                            transformControl.attach(this.getParents(object));\n                        }\n\n                        //let uuid=object.uuid;\n                        // console.log(uuid);\n                        this.$bus.$emit('getEvent',this.getParents(object));\n                    }\n\n                }else{\n                    //当点击到场景空白处时禁用可控件\n                   transformControl.detach();\n                    scene.remove(transformControl);\n                    let object=null;\n                    this.$bus.$emit('getEvent',object);\n                }\n            });\n        },\n        //射线拾取器\n\n     initLight() {\n        directionalLight = new THREE.DirectionalLight(0xffffff); //添加了一个白色的平行光\n        directionalLight.position.set(20, 50, 50); //设置光的方向\n        directionalLight.name=\"平行光\";\n        scene.add(directionalLight); //添加到场景\n        objs.push(directionalLight);\n        ambientLight=new THREE.AmbientLight(0x222222);\n        ambientLight.name=\"全局光\";\n        //添加一个全局环境光\n        scene.add(ambientLight);\n         objs.push(ambientLight);\n    },\n        // initRaycaster(){\n        //     // raycaster=new THREE.Raycaster();\n\n        // },\n        //对象缓存初始化\n        initCache(){\n            cacheobjects=null;\n        },\n        initControl(){\n  //可视化变换控件对象\n        transformControl = new TransformControls( camera,renderer.domElement );\n        transformControl.type=\"TransformControl\";\n        // scene.add( transformControl );//控件对象添加到场景对象\n        transformControl.addEventListener('mouseDown',(event)=>{\n            //加一个参数控制防止点击事件和拖拽事件冲突\n            transing=true;\n            console.log(transing);\n        });\n        //键盘控制可视化变换控件功能\n        document.addEventListener('keyup',(event)=>{\n            if(event.key=='e'){\n                //E键缩放\n                transformControl.mode=\"scale\";\n                return false;\n            }\n            if(event.key=='r'){\n                //R键旋转\n                transformControl.mode=\"rotate\";\n                return false;\n            }\n            if(event.key=='t'){\n                //T键平移\n                transformControl.mode=\"translate\";\n                return false;\n            }\n\n        });\n        },\n        LoadElement(type){\n\n          scene.background = new THREE.CubeTextureLoader().load([\n          require('@/assets/skybox/'+type+'/Left.png'),\n          require('@/assets/skybox/'+type+'/Right.png'),\n          require('@/assets/skybox/'+type+'/Up.png'),\n          require('@/assets/skybox/'+type+'/Down.png'),\n          require('@/assets/skybox/'+type+'/Front.png'),\n          require('@/assets/skybox/'+type+'/Back.png')\n        ]);\n\n        },\n        AddElement(type){\n            if(type=='lonelyPlanet'){\n                this.initBox();\n            }\n            else if(type=='bezierCurve'){\n                this.initCone();\n            }else if(type=='ethereaTone'){\n                this.initCylinder();\n            }else if(type=='electronicMusic'){\n                this.initSphere();\n            }else if(type=='blastSubwoofer'){\n                this.initTorus();\n            }else if(type=='BarModel'){\n                this.initBars();\n                this.sceneChangedEvent();\n            }else if(type=='LineModel'){\n                this.initLine();\n                this.sceneChangedEvent();\n            }\n        },\n        initBox(){\n            var material=new THREE.MeshStandardMaterial();\n            material.color=new Color(0.8,0.2,0.2);\n            var box=new THREE.Mesh(new THREE.BoxGeometry(5,5,5),material);\n            box.position.set(-50, 20, 0);\n            box.name=\"盒子\";\n            scene.add(box);\n            objs.push(box);\n            this.sceneChangedEvent();\n        },\n       initCone(){\n        var material=new THREE.MeshStandardMaterial();\n        material.color=new Color(0.7,0.6,0.6);\n         var cone=new THREE.Mesh(new THREE.ConeGeometry(5,20,32),material);\n          cone.position.set(20, 20, 0);\n          cone.name=\"圆锥\";\n           scene.add(cone);\n           objs.push(cone);\n          this.sceneChangedEvent();\n           //renderer.render(scene,camera);//渲染\n\n\n       },\n       initCylinder(){\n            var material=new THREE.MeshStandardMaterial();\n            material.color=new Color(0.8,0.7,0.2);\n           var cylinder=new THREE.Mesh(new THREE.CylinderGeometry(5, 5, 20, 32),material);\n           cylinder.position.set(50,20,0);\n           cylinder.name=\"圆柱\";\n           scene.add(cylinder);\n           objs.push(cylinder);\n           this.sceneChangedEvent();\n           //renderer.render(scene,camera);//渲染\n\n       },\n       initSphere(){\n           var material=new THREE.MeshStandardMaterial();\n            material.color=new Color(0.2,0.7,0.2);\n          var  sphere=new THREE.Mesh(new THREE.SphereGeometry(5, 32, 32),material);\n           sphere.position.set(-20, -20, 0);\n           sphere.name=\"球\";\n            scene.add(sphere);\n            objs.push(sphere);\n            this.sceneChangedEvent();\n\n\n\n       },\n       initTorus(){\n           var material=new THREE.MeshStandardMaterial();\n            material.color=new Color(0.3,0.1,0.9);\n           var torus =new THREE.Mesh(new THREE.TorusGeometry(10, 3, 16, 100),material);\n            torus.position.set(50, -20, 0);\n            torus.name=\"圆环\";\n            scene.add(torus);\n            objs.push(torus);\n            this.sceneChangedEvent();\n            //renderer.render(scene,camera);//渲染\n\n\n       },\n        init(){\n            this.initRenderer();\n            this.initScene();\n            this.initCamera();\n            this.initLight();\n            this.initMesh();\n            // this.initRaycaster();\n            this.initCache();\n            this.initCameraControl();\n            this.initControl();\n            this.initHelper();\n            this.watchHelper();\n            // this.initMouseEvent();\n            this.initEventManager();\n            this.sendid();\n            this.initStats();\n\n            // initDatGUI();\n            this.sceneChangedEvent();\n            this.animate();\n           // console.log(scene);\n\n        },\n        watchHelper(){\n            let state=this.state;\n             this.$bus.$emit('stateControl',state);\n        },\n        sceneChangedEvent(){\n            //requestAnimationFrame(this.sceneChangedEvent());\n            let scenelist=scene.children;\n            this.$bus.$emit('sceneChanged',scenelist);\n        },\n        //鼠标事务处理（包括点击事件、移动事件）\n        // initMouseEvent(){\n            //给canvas对象进行鼠标坐标转换\n            // mouse=new Vector2();\n            // let domX=0;\n            // let domY=0;\n            // let width=0;\n            // let height=0;\n            // renderer.domElement.addEventListener('mousemove',(event)=>{\n            //     //console.log(event.offsetX,event.offsetY);\n            //     domX=event.offsetX;\n            //     domY=event.offsetY;\n            //     width=renderer.domElement.offsetWidth;\n            //     height=renderer.domElement.offsetHeight;\n            //     mouse.x=domX/width*2-1;\n            //     mouse.y=-domY*2/height+1;\n            //     // console.log(mouse.x,mouse.y);\n            //     raycaster.setFromCamera(mouse,camera);\n            //     //防止控制器被选中\n            //     scene.remove(transformControl);\n            //     const intersection=raycaster.intersectObjects(scene.children,false);\n            //     //把所有有children的屏蔽掉，可以防止对helper进行控制\n            //     scene.add(transformControl);\n            //     if(intersection.length){\n            //         //如果拾取到材质物体\n            //         const object=intersection[0].object;\n            //         //如果当下物体不是上次缓存物体，说明是从不同物体上移到当前物体上触发mouseenter事件\n            //         if(object!=cacheobjects){\n            //             if(cacheobjects){\n            //                 //当鼠标从一个物体移动到另一个物体时，先触发之前缓存物体的mouseleave方法\n            //                 //再触发当前物体的mouseenter方法\n            //                 cacheobjects.dispatchEvent({\n            //             type:'mouseleave'\n            //         });\n            //             }\n            //               object.dispatchEvent({\n            //             type:'mouseenter'\n            //         });\n            //         }//如果相等触发mousemove方法得到物体坐标(鼠标一直在物体上移动)\n            //         else if(object==cacheobjects){\n            //             object.dispatchEvent({\n            //             type:'mousemove'\n            //         });\n            //         }\n            //         cacheobjects=object;\n            //     }else{\n            //         //当鼠标从一个物体移动到射线拾取器拾取不到物体时也会触发之前的物体的mouseleave方法\n            //          if(cacheobjects){\n            //                 //当鼠标从一个物体移动到另一个物体时，先触发之前缓存物体的mouseleave方法\n            //                 //再触发当前物体的mouseenter方法\n            //                 cacheobjects.dispatchEvent({\n            //             type:'mouseleave'\n            //         });\n            //     }\n            //         cacheobjects=null;\n\n\n            //     }\n\n\n            // });\n            // // //物体拾取事件处理\n            // renderer.domElement.addEventListener('click',(event)=>{\n            //     if(transing){\n            //         transing=false;\n            //         return false;\n            //     }\n            //     // raycaster.setFromCamera(mouse,camera);\n            //     // //防止控制器被选中\n            //     // scene.remove(transformControl);\n            //     // const intersection=raycaster.intersectObjects(scene.children,false);\n            //     // //把所有有children的屏蔽掉，可以防止对helper进行控制\n            //     // scene.add(transformControl);\n            //     // if(intersection.length){\n\n\n            //     //     const object=intersection[0].object;\n            //     //     transformControl.attach(object);\n            //     // }else{\n            //     //     //当点击到场景空白处时禁用可控件\n            //     //    transformControl.detach();\n            //     // }\n            // });\n\n        // },\n        initStats(){\n            stats = new Stats();\n             stats.domElement.style.position = 'absolute'; //绝对坐标\n                stats.domElement.style.left = '0px';// (0,0)px,左上角\n                stats.domElement.style.top = '0px';\n            document.getElementById('webgl').appendChild(stats.domElement);\n\n        },\n        updatePosition(){\n            mesh.position.set(controls.positionX,controls.positionY,controls.positionZ);\n        },\n        //初始化渲染器\n        initRenderer(){\n\n\n            renderer=new THREE.WebGLRenderer({antialias:true});//实例化渲染器\n            //抗锯齿开启\n            renderer.setSize(window.innerWidth*0.7,window.innerHeight*0.7);//设置宽高\n            document.getElementById('webgl').appendChild(renderer.domElement);//添加到dom\n        },\n        //初始化场景\n        initScene(){\n\n            scene=new THREE.Scene();//实例化场景\n            objs=[];\n             scene.background = new THREE.CubeTextureLoader().load([\n          require('@/assets/skybox/Galaxy/Left.png'),\n          require('@/assets/skybox/Galaxy/Right.png'),\n          require('@/assets/skybox/Galaxy/Up.png'),\n          require('@/assets/skybox/Galaxy/Down.png'),\n          require('@/assets/skybox/Galaxy/Front.png'),\n          require('@/assets/skybox/Galaxy/Back.png')\n        ]);\n        //   scene.background=new THREE.Color( 0xDEE6E6 );\n            // this.$bus.$emit('sceneChanged',scene);\n        },\n        //初始化相机\n        initCamera(){\n            camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.1,200)\n            //实例化相机】\n            camera.position.set(0,0,150);\n        },\n        //创建模型\n        initMesh(){\n            // geometry = new THREE.BoxGeometry(5, 5, 5 ); //创建几何体\n            // var material=new THREE.MeshStandardMaterial();\n            // material.color=new Color(0.7,0.2,0.2); //创建材质\n\n            // mesh = new THREE.Mesh( geometry, material ); //创建网格\n            // mesh.name=\"盒子\";\n\n            // scene.add( mesh ); //将网格添加到场景\n\n\n            // this.initCone();\n            // this.initBox();\n            this.initLine();\n            this.initBars();\n\n        },\n\n        initBars(){\n            this.audioBars(25,128);\n        },\n\n        audioBars(radius, countData) {\n      let barGroup = new THREE.Group();\n      let R = radius;\n      let N = countData;\n      for (let i = 0; i < N; i++) {\n        let minGroup = new THREE.Group();\n        let box = new THREE.BoxGeometry(1, 1, 1);\n        let material = new THREE.MeshPhongMaterial({\n          color: 0x00ffff\n        }); // 材质对象\n        let m = i;\n        let mesh = new THREE.Mesh(box, material);\n\n        mesh.position.y = 0.5;\n        minGroup.add(mesh);\n        minGroup.position.set(\n          Math.sin(((m * Math.PI) / N) * 2) * R,\n          Math.cos(((m * Math.PI) / N) * 2) * R,\n          0\n        );\n       minGroup.rotation.z = ((-m * Math.PI) / N) * 2;\n        barGroup.add(minGroup);\n      }\n      barGroup.name=\"音频谱\";\n      barGroup.type=\"BarGroup\";\n      scene.add(barGroup);\n      objs.push(barGroup);\n    },\n/* 这里有个原理，为什么对音频线和音频组进行移动旋转操作后 依然可以根据初始化的音频数据进行重画\n按原理来说应该要重新计算各个线段的坐标值进行重绘，为什么这里导出数据后依然可以利用初始化的\nbarNodes进行一个线段计算重回吧，原因是因为，在编辑器中对一个组对象进行操作时，其各子对象\n的坐标并不会变化，只改变这个组对象的位置、旋转等信息，其子对象的坐标一直是相对于其父对象的\n坐标即本地坐标，而非世界坐标，只有当父对象是scene场景时，本地坐标才等于世界坐标\n */\n        initLine(){\n            this.audioLines(20,256);\n        },\n        renderGeometries(vertices) {\n            const res = [];\n            vertices = vertices.concat(vertices[0]);\n            //合并数组，把里外位置告知要画的线\n            vertices.forEach(value => {\n            res.push(value.x, value.y, 0);\n      });\n            return new THREE.BufferAttribute(new Float32Array(res), 3);\n    },\n        audioLines(radius, countData) {\n            var barNodes = range(0, countData).map(index => {\n                return new node(\n                radius,\n                ((index / countData) * 360 + 45) % 360,\n                new THREE.Vector2(0, 0)\n                );\n            });\n            console.log(barNodes);\n            //得到一个记录圆上256个点的位置信息的数组\n            const lineMaterial = new THREE.LineBasicMaterial({\n                color: 0x00ffff\n            });\n            var barLine = range(0, countData).map(index => {\n            return new THREE.Line(\n                new THREE.BufferGeometry().setAttribute(\n                    \"position\",\n                this.renderGeometries([\n                    barNodes[index].positionA(),\n                     barNodes[index].positionB()\n            ])\n          ),\n            lineMaterial\n            );\n        });\n        var outLine = new THREE.Line(\n        new THREE.BufferGeometry().setAttribute(\n          \"position\",\n          this.renderGeometries(barNodes.map(node => node.positionA()))\n        ),\n        lineMaterial\n      );\n\n      var inLine = new THREE.Line(\n        new THREE.BufferGeometry().setAttribute(\n          \"position\",\n          this.renderGeometries(barNodes.map(node => node.positionB()))\n        ),\n        lineMaterial\n      );\n\n      var linesGroup = new THREE.Group();\n      linesGroup.add(outLine);\n      linesGroup.add(inLine);\n      barLine.forEach(line => linesGroup.add(line));\n      linesGroup.name=\"音频线\";\n      linesGroup.type=\"LineGroup\";\n      scene.add(linesGroup);\n      objs.push(linesGroup);\n    },\n\n\n\n        update(){\n            stats.update();\n        },\n        Reset(){\n\n        },\n        ResetAll(){\n            this.$bus.$on('reset',()=>{\n                this.Reset();\n            });\n        },\n        Export(){\n            let that=this;\n            this.$bus.$on('export',()=>{\n            // if(scene.children.length>0){\n            //     let obj;\n            //     //删除所有helper，只保留光源、材质\n            //     for(var i=scene.children.length-1;i>=0;i--){\n            //\n            //          obj=scene.children[i];\n            //         if(obj.type.indexOf('Helper')!=-1||obj.type.indexOf('Control')!=-1){\n            //              scene.remove(obj);\n            //         }\n            //     }\n            // }\n              that.RemoveHelperAndControl();\n\n                //因为每次迭代中.children 一旦remove后从头开始执行\n                //数组会改变，因此使用遍历的forEach也好，traverse也好数组的\n                //索引全都改变，只会删除一个对象\n                //但如果从后开始遍历删除，每次remove后前面的索引也即是未遍历过的节点索引不会变\n                //使用state值然后进行深度监听依然不行，因为watch方法每次在mounted之后\n                //这就导致了如果mounted中的data值变化，我需要导出的数据还是原来数据，watch只会在之后\n                //发生作用。\n\n            var JSONStr=JSON.stringify(scene.toJSON());\n\n            this.download(\"scene.json\",JSONStr);\n            that.AddHelperAndControl();\n            });\n        },\n        download(filename,text){\n            var pom=document.createElement('a');\n            pom.setAttribute('href','data:text/plain;charset=utf-8,'\n            +encodeURIComponent(text));\n            pom.setAttribute('download',filename);\n            if(document.createEvent){\n                var event=document.createEvent('MouseEvents');\n                event.initMouseEvent('click',true, false,\n                window,0,0,0,0,0,false,false,false,false,0,null);\n                pom.dispatchEvent(event);\n            }else{\n                pom.click();\n            }\n\n        },\n        //运行动画\n        animate(){\n            id=requestAnimationFrame(this.animate);//循环调用函数\n\n            // mesh.rotation.x+=0.01;\n            // // //每帧网格模型沿x轴旋转0.01弧度\n            // mesh.rotation.y+=0.02;\n            // //每帧网格模型沿y轴旋转0.02弧度\n            // //stats.update();//更新性能检测框\n\n            this.update();\n            renderer.render(scene,camera);//渲染\n        },\n      sendres(){\n          this.$bus.$on('sendres',(res)=>{\n           var loader=new THREE.ObjectLoader();\n           loader.parse(res,function (obj){\n             scene=obj;\n\n           })\n          })\n      },\n      requestsave(){\n          let that=this;\n        this.$bus.$on('requestsave',()=>{\n          // if(scene.children.length>0){\n          //   let obj;\n          //   //删除所有helper，只保留光源、材质\n          //   for(var i=scene.children.length-1;i>=0;i--){\n          //\n          //     obj=scene.children[i];\n          //     if(obj.type.indexOf('Helper')!=-1||obj.type.indexOf('Control')!=-1){\n          //       scene.remove(obj);\n          //     }\n          //   }\n          // }\n          that.RemoveHelperAndControl();\n          var JSONStr=JSON.stringify(scene.toJSON());\n          let file=new File([JSONStr],'scene.json',{\n            type: 'application/json',\n            lastModified: Date.now()\n          });\n          //组合成文件\n          let param=new FormData();\n          param.append('file',file);\n          let config={headers:{'Content-Type':'multipart/form-data'}}\n          this.request.post(\"http://localhost:9090/upload\",\n            param,config).then(res=>{\n            // console.log(res);\n            that.$bus.$emit('responsesave',res.fileid);\n            console.log(res.fileid);\n            console.log(scene);\n            that.AddHelperAndControl();\n          });\n          //提交表单文件返回id\n\n\n        });\n      },\n      sendid(){\n        let id=null;\n        this.$bus.$emit('sendfileid',id);\n      },\n      startedit(){\n\n          let that=this;\n        this.$bus.$on('eidtfile',(res,id)=>{\n          //objs=[];\n          //因为每次跳转路由都会重新初始化其他工具，这里先删除\n          //把json数据打包成文件通过url进行传输\n          var JSONStr=JSON.stringify(res);\n          let file=new File([JSONStr],'scene.json',{\n            type: 'application/json',\n            lastModified: Date.now()\n          });\n          //组合成文件\n          let url = null ;\n          if (window.createObjectURL!=undefined) { // basic\n            url = window.createObjectURL(file) ;\n          } else if (window.URL!=undefined) { // mozilla(firefox)\n            url = window.URL.createObjectURL(file) ;\n          } else if (window.webkitURL!=undefined) { // webkit or chrome\n            url = window.webkitURL.createObjectURL(file) ;\n          }\n\n\n          //that.RemoveHelperAndControl();\n          var loader=new THREE.ObjectLoader();\n          loader.load(url,\n            function(obj){\n             //let newobjs=[];\n            that.RemoveHelperAndControl();\n            scene=obj;\n            that.AddHelperAndControl();\n              // if(obj.children.length>0){\n              //   let childobj;\n              //   for(var i=obj.children.length-1;i>=0;i--){\n              //     childobj=obj.children[i];\n              //     if(childobj.type.indexOf('Object3D')!=-1||childobj.type.indexOf('Mesh')!=-1){\n              //       newobjs.push(childobj);\n              //     }\n              //     if((childobj.type.indexOf('Light')!=-1&&childobj.type.indexOf('Helper')==-1)){\n              //       newobjs.push(childobj);\n              //     }\n              //   }\n              // }\n              // objs=newobjs;\n              // console.log(objs);\n\n\n              // if(scene.children.length>0){\n              //   let childobj;\n              //   //删除所有可操作对象\n              //   for(var i=scene.children.length-1;i>=0;i--){\n              //     childobj=scene.children[i];\n              //     if((childobj.type.indexOf('Light')!=-1&&childobj.type.indexOf('Helper')==-1)||childobj.type.indexOf('Group')!=-1||childobj.type.indexOf('Mesh')!=-1){\n              //       scene.remove(childobj);\n              //\n              //     }\n              //\n              //   } console.log(scene);\n                //console.log(objs);\n              // }\n              //加载完成后进行\n              // scene.background=obj.background;\n              // if(obj.children.length>0) {\n              //   let childobj;\n              //   for (var i = obj.children.length - 1; i >= 0; i--) {\n              //     childobj = obj.children[i];\n              //     obj.remove(childobj);\n              //     childobj.parent=scene;\n              //     scene.add(childobj);\n              //     objs.push(childobj);\n              //   }\n              // }\n              eventManager.RemoveEvent();\n             that.initEventManager();\n              that.sceneChangedEvent();\n              //console.log(objs);\n            },\n            // onProgress callback\n            function ( xhr ) {\n              console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );\n            },\n\n            // onError callback\n            function ( err ) {\n              console.error( 'An error happened'+err );\n            });\n          // loader.parse(res,function (obj){\n          //\n          //  }\n          //  console.log(scene);\n            //console.log(scene);\n           //  that.AddHelperAndControl();\n           //  //需要初始化一下objs\n           //  if(scene.children.length>0){\n           //    let obj;\n           //    //删除所有helper，只保留光源、材质\n           //    objs=[];\n           //    //初始化一下\n           //    for(var i=scene.children.length-1;i>=0;i--){\n           //\n           //      obj=scene.children[i];\n           //      if(obj.type.indexOf('Mesh')!=-1){\n           //        //说明是需要操作的物体\n           //        objs.push(obj);\n           //      }\n           //      if(obj.type.indexOf('Object3D')!=-1){\n           //        objs.push(obj);\n           //      }\n           //      // if(obj.type.indexOf('Light')!=-1&&obj.type.indexOf('Helper')==-1){\n           //      //   objs.push(obj);\n           //      // }\n           //    }\n           //    console.log(objs);\n           //  }\n           //  transing=false;\n           //\n           // // that.initEventManager();\n          //    that.sceneChangedEvent();\n          //\n          // });\n          that.$bus.$emit('sendfileid',id);\n\n        });\n      },\n      addnew(){\n          let that=this;\n          this.$bus.$off('addfile');\n        this.$bus.$on('addfile',()=>{\n          let id=null;\n          that.$bus.$emit('sendfileid',id);\n          //设置个时间防止 加载问题\n\n          that.RemoveHelperAndControl();\n          that.initScene();\n          that.initLight();\n          that.initMesh();\n          that.AddHelperAndControl();\n          eventManager.RemoveEvent();\n          that.initEventManager();\n          that.sceneChangedEvent();\n        });\n      }\n    },\n\n  mounted() {\n        this.init();\n        this.CheckFromTree();\n        this.findcurrentObj();\n        this.AddModel();\n        this.ResetAll();\n        this.Export();\n        this.sendres();\n        this.requestsave();\n        this.startedit();\n        this.addnew();\n    },\n}\n</script>\n<style>\n #webgl {\n    height: 500px;\n  }\n.app-container{\n    background-color: #432d43;\n}\n</style>\n"]}]}